ø
øD:\Banobras\Sistemas .NET\SST3\SIVARMER\TransicionNvaFSW\Trunk\C√≥digo\RiesgosSimefin_Oracle_2024_05_29\Riesgos.Simefin\Riesgos.Simefin.Infrastructure.Oracle\Helpers\OracleConnectionHelper.cs
	namespace 	
Riesgos
 
. 
Simefin 
. 
Infrastructure (
.( )
Oracle) /
./ 0
Helpers0 7
{ 
public		 

static		 
class		 "
OracleConnectionHelper		 .
{

 
private 
static 
IConfiguration %
?% &
_configuration' 5
;5 6
public 
static 
void 

Initialize %
(% &
IConfiguration& 4
configuration5 B
)B C
{ 	
_configuration 
= 
configuration *
;* +
} 	
public 
static 
OracleConnection &
GetConnection' 4
(4 5
)5 6
{ 	
string 
environmentVariable &
=' (
_configuration) 7
!7 8
.8 9

GetSection9 C
(C D
$strD Y
)Y Z
.Z [
Value[ `
!` a
;a b
string $
environmentVariableValue +
=, -
Environment. 9
.9 :"
GetEnvironmentVariable: P
(P Q
environmentVariableQ d
)d e
!e f
;f g
if 
( 
! 
string 
. 
IsNullOrEmpty %
(% &$
environmentVariableValue& >
)> ?
)? @
{ 
var 
data 
= 
JsonConvert &
.& '
DeserializeObject' 8
<8 9 
EnvironmentVariables9 M
>M N
(N O$
environmentVariableValueO g
!g h
)h i
;i j
string 
connectionString '
=( )
_configuration* 8
!8 9
.9 :

GetSection: D
(D E
$strE X
)X Y
.Y Z

GetSectionZ d
(d e
$stre u
)u v
.v w
Valuew |
!| }
;} ~
string !
valueConnectionString ,
=- .
string/ 5
.5 6
Format6 <
(< =
connectionString= M
,M N
dataO S
!S T
.T U
ServerNameOrIPU c
,c d
datae i
.i j
Portj n
,n o
datap t
.t u
Schemeu {
,{ |
data	} Å
.
Å Ç
UserId
Ç à
,
à â
data
ä é
.
é è
Password
è ó
)
ó ò
;
ò ô
var 

connection 
=  
new! $
OracleConnection% 5
(5 6!
valueConnectionString6 K
)K L
;L M
return 

connection !
;! "
} 
return   
new   
OracleConnection   '
(  ' (
)  ( )
;  ) *
}!! 	
}$$ 
}&& √/
ºD:\Banobras\Sistemas .NET\SST3\SIVARMER\TransicionNvaFSW\Trunk\C√≥digo\RiesgosSimefin_Oracle_2024_05_29\Riesgos.Simefin\Riesgos.Simefin.Infrastructure.Oracle\Repositories\UserRepository.cs
	namespace 	
Riesgos
 
. 
Simefin 
. 
Infrastructure (
.( )
Oracle) /
./ 0
Repositories0 <
{		 
public 

class 
UserRepository 
:  !
IUserRepository" 1
{ 
private 
readonly 
IConfiguration '
_configuration( 6
;6 7
private 
readonly 
string 
?  
_usersTableName! 0
=1 2
string3 9
.9 :
Empty: ?
;? @
public 
UserRepository 
( 
IConfiguration ,
configuration- :
): ;
{ 	
_configuration 
= 
configuration *
;* +
_usersTableName 
= 
_configuration ,
., -

GetSection- 7
(7 8
$str8 H
)H I
.I J

GetSectionJ T
(T U
$strU a
)a b
.b c
Valuec h
!h i
;i j
} 	
public 
async 
Task 
< 
int 
> 
AddAsync '
(' (
Usuario( /
entity0 6
)6 7
{   	
using!! 
(!! 
var!! 

connection!! !
=!!" #"
OracleConnectionHelper!!$ :
.!!: ;
GetConnection!!; H
(!!H I
)!!I J
)!!J K
{"" 
await## 

connection##  
.##  !
	OpenAsync##! *
(##* +
)##+ ,
;##, -
var$$ 

parameters$$ 
=$$  
new$$! $
{%% 

p_UserName'' 
=''  
entity''! '
.''' (
UserName''( 0
,''0 1
p_Nombre(( 
=(( 
entity(( %
.((% &
Nombre((& ,
,((, -

p_Password)) 
=))  
entity))! '
.))' (
Password))( 0
,))0 1
p_Rol** 
=** 
entity** "
.**" #
Rol**# &
}++ 
;++ 
var,, 
query,, 
=,, 
@$",, 
$str,, +
{,,+ ,
_usersTableName,,, ;
},,; <
$str,-< P
"--P Q
;--Q R
var.. 
rowsAffected..  
=..! "
await..# (

connection..) 3
...3 4
ExecuteAsync..4 @
(..@ A
query..A F
,..F G

parameters..H R
)..R S
;..S T
return// 
rowsAffected// #
;//# $
}00 
}11 	
public33 
Task33 
<33 
bool33 
>33 
DeleteAsync33 %
(33% &
int33& )
id33* ,
)33, -
{44 	
throw55 
new55 #
NotImplementedException55 -
(55- .
)55. /
;55/ 0
}66 	
public<< 
async<< 
Task<< 
<<< 
IEnumerable<< %
<<<% &
Usuario<<& -
><<- .
><<. /
GetAllAsync<<0 ;
(<<; <
)<<< =
{== 	
using>> 
(>> 
OracleConnection>> #

connection>>$ .
=>>/ 0"
OracleConnectionHelper>>1 G
.>>G H
GetConnection>>H U
(>>U V
)>>V W
)>>W X
{?? 
await@@ 

connection@@  
.@@  !
	OpenAsync@@! *
(@@* +
)@@+ ,
;@@, -
stringAA 
strQueryAA 
=AA  !
@$"AA" %
$strAA% U
{AAU V
_usersTableNameAAV e
}AAe f
"AAf g
;AAg h
returnBB 
awaitBB 

connectionBB '
.BB' (

QueryAsyncBB( 2
<BB2 3
UsuarioBB3 :
>BB: ;
(BB; <
strQueryBB< D
)BBD E
;BBE F
}CC 
}DD 	
publicKK 
asyncKK 
TaskKK 
<KK 
UsuarioKK !
>KK! "
GetByIdAsyncKK# /
(KK/ 0
intKK0 3
userIdKK4 :
)KK: ;
{LL 	
usingMM 
(MM 
OracleConnectionMM #

connectionMM$ .
=MM/ 0"
OracleConnectionHelperMM1 G
.MMG H
GetConnectionMMH U
(MMU V
)MMV W
)MMW X
{NN 
awaitOO 

connectionOO  
.OO  !
	OpenAsyncOO! *
(OO* +
)OO+ ,
;OO, -
varPP 

parametersPP 
=PP  
newPP! $
{PP% &
p_IdPP' +
=PP, -
userIdPP. 4
}PP5 6
;PP6 7
stringQQ 
strQueryQQ 
=QQ  !
@$"QQ" %
$strQQ% U
{QQU V
_usersTableNameQQV e
}QQe f
$strQQf w
"QQw x
;QQx y
varRR 
userRR 
=RR 
awaitRR  

connectionRR! +
.RR+ ,$
QueryFirstOrDefaultAsyncRR, D
<RRD E
UsuarioRRE L
>RRL M
(RRM N
strQueryRRN V
,RRV W

parametersRRX b
)RRb c
;RRc d
returnTT 
userTT 
!TT 
;TT 
}UU 
}VV 	
publicXX 
TaskXX 
<XX 
boolXX 
>XX 
UpdateAsyncXX %
(XX% &
UsuarioXX& -
entityXX. 4
)XX4 5
{YY 	
throwZZ 
newZZ #
NotImplementedExceptionZZ -
(ZZ- .
)ZZ. /
;ZZ/ 0
}\\ 	
}]] 
}__ ìç
¡D:\Banobras\Sistemas .NET\SST3\SIVARMER\TransicionNvaFSW\Trunk\C√≥digo\RiesgosSimefin_Oracle_2024_05_29\Riesgos.Simefin\Riesgos.Simefin.Infrastructure.Oracle\Repositories\PortfolioRepository.cs
	namespace 	
Riesgos
 
. 
Simefin 
. 
Infrastructure (
.( )
Oracle) /
./ 0
Repositories0 <
{ 
public 

class 
PortfolioRepository $
:% & 
IPortfolioRepository' ;
{ 
private 
readonly 
IConfiguration '
_configuration( 6
;6 7
private 
readonly 
string 
_portfolioTableName  3
=4 5
string6 <
.< =
Empty= B
;B C
private 
readonly 
string "
_subPortfolioTableName  6
=7 8
string9 ?
.? @
Empty@ E
;E F
private 
readonly 
string 
_historialTableName  3
=4 5
string6 <
.< =
Empty= B
;B C
public 
PortfolioRepository "
(" #
IConfiguration# 1
configuration2 ?
)? @
{ 	
_configuration   
=   
configuration   *
;  * +
_portfolioTableName"" 
=""  !
_configuration""" 0
.""0 1

GetSection""1 ;
(""; <
$str""< L
)""L M
.""M N

GetSection""N X
(""X Y
$str""Y h
)""h i
.""i j
Value""j o
!""o p
;""p q"
_subPortfolioTableName## "
=### $
_configuration##% 3
.##3 4

GetSection##4 >
(##> ?
$str##? O
)##O P
.##P Q

GetSection##Q [
(##[ \
$str##\ n
)##n o
.##o p
Value##p u
!##u v
;##v w
_historialTableName$$ 
=$$  !
_configuration$$" 0
.$$0 1

GetSection$$1 ;
($$; <
$str$$< L
)$$L M
.$$M N

GetSection$$N X
($$X Y
$str$$Y f
)$$f g
.$$g h
Value$$h m
!$$m n
;$$n o
}%% 	
public,, 
async,, 
Task,, 
<,, 
IEnumerable,, %
<,,% &

Portafolio,,& 0
>,,0 1
>,,1 2
GetAllAsync,,3 >
(,,> ?
List,,? C
<,,C D
object,,D J
>,,J K
?,,K L
filters,,M T
=,,U V
null,,W [
),,[ \
{-- 	
using.. 
(.. 
IDbConnection..  

connection..! +
=.., -"
OracleConnectionHelper... D
...D E
GetConnection..E R
(..R S
)..S T
)..T U
{// 

connection11 
.11 
Open11 
(11  
)11  !
;11! "
string22 
strQuery22 
=22  !
string22" (
.22( )
Empty22) .
;22. /
string33 
strWhere33 
=33  !
string33" (
.33( )
Empty33) .
;33. /
int44 
countParameters44 #
=44$ %
$num44& '
;44' (
var55 

filterList55 
=55  
new55! $

Dictionary55% /
<55/ 0
string550 6
,556 7
object558 >
>55> ?
(55? @
)55@ A
{55B C
}55D E
;55E F
if66 
(66 
filters66 
!=66 
null66 #
)66# $
{77 
strWhere88 
=88 
$str88 (
;88( )
foreach99 
(99 
var99  
item99! %
in99& (
filters99) 0
!990 1
)991 2
{:: 
countParameters;; '
+=;;( *
$num;;+ ,
;;;, -
var<< 
props<< !
=<<" #
item<<$ (
.<<( )
GetType<<) 0
(<<0 1
)<<1 2
.<<2 3
GetProperties<<3 @
(<<@ A
)<<A B
;<<B C
var== 
pairs== !
===" #
props==$ )
.==) *
Select==* 0
(==0 1
x==1 2
=>==3 5
x==6 7
.==7 8
Name==8 <
+=== >
$str==? B
+==C D
x==E F
.==F G
GetValue==G O
(==O P
item==P T
,==T U
null==V Z
)==Z [
)==[ \
.==\ ]
ToArray==] d
(==d e
)==e f
;==f g
var>> 
pairDictionary>> *
=>>+ ,
props>>- 2
.>>2 3
ToDictionary>>3 ?
(>>? @
x>>@ A
=>>>B D
x>>E F
.>>F G
Name>>G K
,>>K L
x>>M N
=>>>O Q
x>>R S
.>>S T
GetValue>>T \
(>>\ ]
item>>] a
,>>a b
null>>c g
)>>g h
?>>h i
.>>i j
ToString>>j r
(>>r s
)>>s t
)>>t u
;>>u v
var?? 
	columName?? %
=??& '
pairDictionary??( 6
.??6 7
Keys??7 ;
.??; <
Select??< B
(??B C
x??C D
=>??E G
x??H I
)??I J
.??J K
FirstOrDefault??K Y
(??Y Z
)??Z [
;??[ \
var@@ 
parameterName@@ )
=@@* +
$"@@, .
$str@@. 0
{@@0 1
	columName@@1 :
}@@: ;
"@@; <
;@@< =
ifAA 
(AA 
countParametersAA +
>AA, -
$numAA. /
)AA/ 0
{BB 
strWhereCC $
+=CC% '
$strCC( /
;CC0 1
}DD 
strWhereEE  
+=EE! #
$"EE$ &
$strEE& (
{EE( )
	columNameEE) 2
}EE2 3
$strEE3 7
{EE7 8
parameterNameEE8 E
}EEE F
"EEF G
;EEG H
}FF 

filterListGG 
=GG  
thisGG! %
.GG% &!
GetAnonymusParametersGG& ;
(GG; <
filtersGG< C
)GGC D
;GGD E
strQueryHH 
=HH 
@$"HH "
$strHI" %
{II% &
_portfolioTableNameII& 9
}II9 :
$strII: H
{IIH I"
_subPortfolioTableNameIII _
}II_ `
$str	II` ã
"
IIã å
;
IIå ç
strQueryJJ 
+=JJ 
strWhereJJ  (
;JJ( )
}KK 
elseLL 
{MM 
strQueryNN 
=NN 
@$"NN "
$strNO" %
{OO% &
_portfolioTableNameOO& 9
}OO9 :
$strOO: H
{OOH I"
_subPortfolioTableNameOOI _
}OO_ `
$str	OO` ã
"
OOã å
;
OOå ç
}PP 
stringQQ 
strOrderQQ 
=QQ  !
$strQQ" @
;QQ@ A
varRR 

portfoliosRR 
=RR  
awaitRR! &

connectionRR' 1
.RR1 2

QueryAsyncRR2 <
<RR< =

PortafolioRR= G
>RRG H
(RRH I
strQueryRRI Q
+RRR S
strOrderRRT \
,RR\ ]

filterListRR^ h
)RRh i
;RRi j

portfoliosSS 
.SS 
ToListSS !
(SS! "
)SS" #
.SS# $
ForEachSS$ +
(SS+ ,
	portfolioSS, 5
=>SS6 8
{SS9 :
ifTT 
(TT 
	portfolioTT !
!=TT" $
nullTT% )
&&TT* ,
	portfolioTT- 6
.TT6 7

ListaDatosTT7 A
!=TTB D
nullTTE I
)TTI J
{UU 
	portfolioVV !
!VV! "
.VV" #

ListaDatosVV# -
=VV. /
JsonConvertVV0 ;
.VV; <
DeserializeObjectVV< M
<VVM N
ListVVN R
<VVR S
ListaDatosDTOVVS `
>VV` a
>VVa b
(VVb c
	portfolioVVc l
.VVl m

ListaDatosVVm w
!VVw x
)VVx y
;VVy z
}WW 
}XX 
)XX 
;XX 
returnYY 

portfoliosYY !
;YY! "
}ZZ 
}[[ 	
publicbb 
asyncbb 
Taskbb 
<bb 

Portafoliobb $
>bb$ %
GetByIdAsyncbb& 2
(bb2 3
intbb3 6
idbb7 9
)bb9 :
{cc 	
usingdd 
(dd 
OracleConnectiondd #

connectiondd$ .
=dd/ 0"
OracleConnectionHelperdd1 G
.ddG H
GetConnectionddH U
(ddU V
)ddV W
)ddW X
{ee 
awaitff 

connectionff  
.ff  !
	OpenAsyncff! *
(ff* +
)ff+ ,
;ff, -
vargg 

parametersgg 
=gg  
newgg! $
{gg% &
p_Idgg' +
=gg, -
idgg. 0
}gg1 2
;gg2 3
stringhh 
strQueryhh 
=hh  !
@$"hh" %
$strhi% )
{ii) *
_portfolioTableNameii* =
}ii= >
$strii> L
{iiL M"
_subPortfolioTableNameiiM c
}iic d
$strijd >
"jj> ?
;jj? @
varkk 
	portfoliokk 
=kk 
awaitkk  %

connectionkk& 0
.kk0 1$
QueryFirstOrDefaultAsynckk1 I
<kkI J

PortafoliokkJ T
>kkT U
(kkU V
strQuerykkV ^
,kk^ _

parameterskk` j
)kkj k
;kkk l
ifmm 
(mm 
	portfoliomm 
!=mm  
nullmm! %
&&mm& (
	portfoliomm) 2
.mm2 3

ListaDatosmm3 =
!=mm> @
nullmmA E
)mmE F
{nn 
	portfoliooo 
!oo 
.oo 

ListaDatosoo )
=oo* +
JsonConvertoo, 7
.oo7 8
DeserializeObjectoo8 I
<ooI J
ListooJ N
<ooN O
ListaDatosDTOooO \
>oo\ ]
>oo] ^
(oo^ _
	portfoliooo_ h
.ooh i

ListaDatosooi s
!oos t
)oot u
;oou v
}pp 
returnrr 
	portfoliorr  
!rr  !
;rr! "
}ss 
}tt 	
public{{ 
async{{ 
Task{{ 
<{{ 
int{{ 
>{{ 
AddAsync{{ '
({{' (

Portafolio{{( 2
entity{{3 9
){{9 :
{|| 	
using}} 
(}} 
var}} 

connection}} !
=}}" #"
OracleConnectionHelper}}$ :
.}}: ;
GetConnection}}; H
(}}H I
)}}I J
)}}J K
{~~ 
await 

connection  
.  !
	OpenAsync! *
(* +
)+ ,
;, -
var
ÄÄ 

parameters
ÄÄ 
=
ÄÄ  
new
ÄÄ! $
{
ÅÅ 
p_FechaCreacion
ÉÉ #
=
ÉÉ$ %
DateTime
ÉÉ& .
.
ÉÉ. /
UtcNow
ÉÉ/ 5
,
ÉÉ5 6!
p_FechaModificacion
ÑÑ '
=
ÑÑ( )
DateTime
ÑÑ* 2
.
ÑÑ2 3
UtcNow
ÑÑ3 9
,
ÑÑ9 :
p_F_Posicion
ÖÖ  
=
ÖÖ! "
entity
ÖÖ# )
.
ÖÖ) *

F_Posicion
ÖÖ* 4
!
ÖÖ4 5
,
ÖÖ5 6
p_ListaDatos
ÜÜ  
=
ÜÜ! "
entity
ÜÜ# )
.
ÜÜ) *

ListaDatos
ÜÜ* 4
!
ÜÜ4 5
,
ÜÜ5 6 
p_NombrePortafolio
áá &
=
áá' (
entity
áá) /
.
áá/ 0
NombrePortafolio
áá0 @
!
áá@ A
,
ááA B

p_No_Envio
ââ 
=
ââ  
$num
ââ! "
,
ââ" #
p_SubPortafolioId
ãã %
=
ãã& '
entity
ãã( .
.
ãã. /
SubPortafolioId
ãã/ >
}
åå 
;
åå 
var
çç 
query
çç 
=
çç 
@$"
çç 
$str
çç +
{
çç+ ,!
_portfolioTableName
çç, ?
}
çç? @
$strçé@ ü
"ééü †
;éé† °
var
èè 
rowsAffected
èè  
=
èè! "
await
èè# (

connection
èè) 3
.
èè3 4
ExecuteAsync
èè4 @
(
èè@ A
query
èèA F
,
èèF G

parameters
èèH R
)
èèR S
;
èèS T
return
êê 
rowsAffected
êê #
;
êê# $
}
ëë 
}
íí 	
public
ôô 
async
ôô 
Task
ôô 
<
ôô 
bool
ôô 
>
ôô 
UpdateAsync
ôô  +
(
ôô+ ,

Portafolio
ôô, 6
entity
ôô7 =
)
ôô= >
{
öö 	
using
õõ 
(
õõ 
var
õõ 

connection
õõ !
=
õõ" #$
OracleConnectionHelper
õõ$ :
.
õõ: ;
GetConnection
õõ; H
(
õõH I
)
õõI J
)
õõJ K
{
úú 
await
ùù 

connection
ùù  
.
ùù  !
	OpenAsync
ùù! *
(
ùù* +
)
ùù+ ,
;
ùù, -
var
ûû 

parameters
ûû 
=
ûû  
new
ûû! $
{
üü 
p_Id
†† 
=
†† 
entity
†† !
.
††! "
IdPortafolio
††" .
,
††. /!
p_FechaModificacion
°° '
=
°°( )
DateTime
°°* 2
.
°°2 3
UtcNow
°°3 9
,
°°9 :
p_ListaDatos
££  
=
££! "
entity
££# )
.
££) *

ListaDatos
££* 4
,
££4 5

p_No_Envio
§§ 
=
§§  
entity
§§! '
.
§§' (
No_Envio
§§( 0
+
§§1 2
$num
§§3 4
}
•• 
;
•• 
var
¶¶ 
query
¶¶ 
=
¶¶ 
@$"
¶¶ 
$str
¶¶ &
{
¶¶& '!
_portfolioTableName
¶¶' :
}
¶¶: ;
$str
¶™; 6
"
™™6 7
;
™™7 8
var
´´ 
affectedRows
´´  
=
´´! "
await
´´# (

connection
´´) 3
.
´´3 4
ExecuteAsync
´´4 @
(
´´@ A
query
´´A F
,
´´F G

parameters
´´H R
)
´´R S
;
´´S T
return
¨¨ 
affectedRows
¨¨ #
>
¨¨$ %
$num
¨¨& '
;
¨¨' (
}
≠≠ 
}
ÆÆ 	
public
µµ 
async
µµ 
Task
µµ 
<
µµ 
bool
µµ 
>
µµ 
DeleteAsync
µµ  +
(
µµ+ ,
int
µµ, /
id
µµ0 2
)
µµ2 3
{
∂∂ 	
using
∑∑ 
(
∑∑ 
var
∑∑ 

connection
∑∑ !
=
∑∑" #$
OracleConnectionHelper
∑∑$ :
.
∑∑: ;
GetConnection
∑∑; H
(
∑∑H I
)
∑∑I J
)
∑∑J K
{
∏∏ 
await
ππ 

connection
ππ  
.
ππ  !
	OpenAsync
ππ! *
(
ππ* +
)
ππ+ ,
;
ππ, -
var
∫∫ 

parameters
∫∫ 
=
∫∫  
new
∫∫! $
{
∫∫% &
p_Id
∫∫' +
=
∫∫, -
id
∫∫. 0
}
∫∫1 2
;
∫∫2 3
var
ªª 
affectedRows
ªª  
=
ªª! "
await
ªª# (

connection
ªª) 3
.
ªª3 4
ExecuteAsync
ªª4 @
(
ªª@ A
$"
ªªA C
$str
ªªC O
{
ªªO P!
_portfolioTableName
ªªP c
}
ªªc d
$str
ªªd 
"ªª Ä
,ªªÄ Å

parametersªªÇ å
)ªªå ç
;ªªç é
return
ºº 
affectedRows
ºº #
>
ºº$ %
$num
ºº& '
;
ºº' (
}
ΩΩ 
}
ææ 	
public
ƒƒ 
async
ƒƒ 
Task
ƒƒ 
<
ƒƒ 
IEnumerable
ƒƒ %
<
ƒƒ% &
SubPortafolios
ƒƒ& 4
>
ƒƒ4 5
>
ƒƒ5 6&
GetAllSubPortfoliosAsync
ƒƒ7 O
(
ƒƒO P
)
ƒƒP Q
{
≈≈ 	
using
∆∆ 
(
∆∆ 
OracleConnection
∆∆ #

connection
∆∆$ .
=
∆∆/ 0$
OracleConnectionHelper
∆∆1 G
.
∆∆G H
GetConnection
∆∆H U
(
∆∆U V
)
∆∆V W
)
∆∆W X
{
«« 
await
»» 

connection
»»  
.
»»  !
	OpenAsync
»»! *
(
»»* +
)
»»+ ,
;
»», -
var
…… 
subPortfolios
…… !
=
……" #
await
……$ )

connection
……* 4
.
……4 5

QueryAsync
……5 ?
<
……? @
SubPortafolios
……@ N
>
……N O
(
……O P
$"
……P R
$str
……R {
{
……{ |%
_subPortfolioTableName……| í
}……í ì
"……ì î
)……î ï
;……ï ñ
return
   
subPortfolios
   $
;
  $ %
}
ÀÀ 
}
ÃÃ 	
public
”” 
async
”” 
Task
”” 
<
”” 
List
”” 
<
”” 
string
”” %
>
””% &
>
””& ' 
SavePortfoliosList
””( :
(
””: ;
List
””; ?
<
””? @

Portafolio
””@ J
>
””J K
portafoliosList
””L [
)
””[ \
{
‘‘ 	
List
’’ 
<
’’ 
string
’’ 
>
’’ 
response
’’ !
=
’’" #
new
’’$ '
List
’’( ,
<
’’, -
string
’’- 3
>
’’3 4
(
’’4 5
)
’’5 6
;
’’6 7
if
◊◊ 
(
◊◊ 
portafoliosList
◊◊ 
.
◊◊  
Any
◊◊  #
(
◊◊# $
)
◊◊$ %
)
◊◊% &
{
ÿÿ 
using
ŸŸ 
(
ŸŸ 
var
ŸŸ 

connection
ŸŸ %
=
ŸŸ& '$
OracleConnectionHelper
ŸŸ( >
.
ŸŸ> ?
GetConnection
ŸŸ? L
(
ŸŸL M
)
ŸŸM N
)
ŸŸN O
{
⁄⁄ 
await
€€ 

connection
€€ $
.
€€$ %
	OpenAsync
€€% .
(
€€. /
)
€€/ 0
;
€€0 1
using
‹‹ 
(
‹‹ 
var
‹‹ 
transaction
‹‹ *
=
‹‹+ ,

connection
‹‹- 7
.
‹‹7 8
BeginTransaction
‹‹8 H
(
‹‹H I
)
‹‹I J
)
‹‹J K
{
›› 
try
ﬁﬁ 
{
ﬂﬂ 
foreach
·· #
(
··$ %
var
··% (
item
··) -
in
··. 0
portafoliosList
··1 @
)
··@ A
{
‚‚ 
List
ÂÂ  $
<
ÂÂ$ %
object
ÂÂ% +
>
ÂÂ+ ,
filters
ÂÂ- 4
=
ÂÂ5 6
new
ÂÂ7 :
List
ÂÂ; ?
<
ÂÂ? @
object
ÂÂ@ F
>
ÂÂF G
(
ÂÂG H
)
ÂÂH I
{
ÂÂJ K
new
ÊÊ$ '
{
ÊÊ( )

F_Posicion
ÁÁ( 2
=
ÁÁ3 4
item
ÁÁ5 9
.
ÁÁ9 :

F_Posicion
ÁÁ: D
}
ËË$ %
,
ËË% &
new
ÈÈ$ '
{
ÈÈ( )
SubPortafolioId
ÍÍ( 7
=
ÍÍ8 9
item
ÍÍ: >
.
ÍÍ> ?
SubPortafolioId
ÍÍ? N
}
ÎÎ$ %
}
ÏÏ  !
;
ÏÏ! "
var
ÓÓ  #
portafolios
ÓÓ$ /
=
ÓÓ0 1
await
ÓÓ2 7
this
ÓÓ8 <
.
ÓÓ< =
GetAllAsync
ÓÓ= H
(
ÓÓH I
filters
ÓÓI P
)
ÓÓP Q
;
ÓÓQ R
if
ÔÔ  "
(
ÔÔ# $
portafolios
ÔÔ$ /
.
ÔÔ/ 0
Any
ÔÔ0 3
(
ÔÔ3 4
)
ÔÔ4 5
&&
ÔÔ6 8
portafolios
ÔÔ9 D
.
ÔÔD E
Count
ÔÔE J
(
ÔÔJ K
)
ÔÔK L
>
ÔÔM N
$num
ÔÔO P
)
ÔÔP Q
{
  !
var
ÒÒ$ '
currentPortolio
ÒÒ( 7
=
ÒÒ8 9
portafolios
ÒÒ: E
.
ÒÒE F
FirstOrDefault
ÒÒF T
(
ÒÒT U
)
ÒÒU V
;
ÒÒV W
currentPortolio
ÚÚ$ 3
!
ÚÚ3 4
.
ÚÚ4 5

ListaDatos
ÚÚ5 ?
=
ÚÚ@ A
item
ÚÚB F
.
ÚÚF G

ListaDatos
ÚÚG Q
;
ÚÚQ R
await
ÛÛ$ )
this
ÛÛ* .
.
ÛÛ. /
UpdateAsync
ÛÛ/ :
(
ÛÛ: ;
currentPortolio
ÛÛ; J
)
ÛÛJ K
;
ÛÛK L
}
ÙÙ  !
else
ıı  $
{
ˆˆ  !
await
˜˜$ )
this
˜˜* .
.
˜˜. /
AddAsync
˜˜/ 7
(
˜˜7 8
item
˜˜8 <
)
˜˜< =
;
˜˜= >
}
¯¯  !
}
˘˘ 
transaction
˙˙ '
.
˙˙' (
Commit
˙˙( .
(
˙˙. /
)
˙˙/ 0
;
˙˙0 1
}
˚˚ 
catch
¸¸ 
(
¸¸ 
	Exception
¸¸ (
ex
¸¸) +
)
¸¸+ ,
{
˝˝ 
response
˛˛ $
.
˛˛$ %
Add
˛˛% (
(
˛˛( )
ex
˛˛) +
.
˛˛+ ,
Message
˛˛, 3
.
˛˛3 4
ToString
˛˛4 <
(
˛˛< =
)
˛˛= >
)
˛˛> ?
;
˛˛? @
transaction
ˇˇ '
.
ˇˇ' (
Rollback
ˇˇ( 0
(
ˇˇ0 1
)
ˇˇ1 2
;
ˇˇ2 3
throw
ÄÄ !
;
ÄÄ! "
}
ÅÅ 
}
ÇÇ 
}
ÉÉ 
}
ÑÑ 
return
ÖÖ 
response
ÖÖ 
;
ÖÖ 
}
ÜÜ 	
public
èè 
async
èè 
Task
èè 
<
èè 
bool
èè 
>
èè 
SaveFileBase64
èè  .
(
èè. /
string
èè/ 5
originalName
èè6 B
,
èèB C
string
èèD J
compoundName
èèK W
,
èèW X
byte
èèY ]
[
èè] ^
]
èè^ _
stringBase64
èè` l
,
èèl m
string
èèn t
origen
èèu {
=
èè| }
$strèè~ Ü
)èèÜ á
{
êê 	
using
ëë 
(
ëë 
var
ëë 

connection
ëë !
=
ëë" #$
OracleConnectionHelper
ëë$ :
.
ëë: ;
GetConnection
ëë; H
(
ëëH I
)
ëëI J
)
ëëJ K
{
íí 
await
ìì 

connection
ìì  
.
ìì  !
	OpenAsync
ìì! *
(
ìì* +
)
ìì+ ,
;
ìì, -
var
îî 

parameters
îî 
=
îî  
new
îî! $
{
ïï 
p_Fecha
ññ 
=
ññ 
DateTime
ññ &
.
ññ& '
UtcNow
ññ' -
,
ññ- .
p_NombreOrigen
óó "
=
óó# $
originalName
óó% 1
,
óó1 2
p_NombreDestino
òò #
=
òò$ %
compoundName
òò& 2
,
òò2 3
	p_Archivo
ôô 
=
ôô 
stringBase64
ôô  ,
,
ôô, -
p_Origen
öö 
=
öö 
$str
öö '
}
õõ 
;
õõ 
var
úú 
query
úú 
=
úú 
@$"
úú 
$str
úú +
{
úú+ ,!
_historialTableName
úú, ?
}
úú? @
$str
úù@ f
"
ùùf g
;
ùùg h
var
ûû 
affectedRows
ûû  
=
ûû! "
await
ûû# (

connection
ûû) 3
.
ûû3 4
ExecuteAsync
ûû4 @
(
ûû@ A
query
ûûA F
,
ûûF G

parameters
ûûH R
)
ûûR S
;
ûûS T
return
üü 
affectedRows
üü #
>
üü$ %
$num
üü& '
;
üü' (
}
†† 
}
°° 	
public
®® 
async
®® 
Task
®® 
<
®® 
ResponseDTO
®® %
>
®®% &
ReadOracleBLOB
®®' 5
(
®®5 6
string
®®6 <
fileDate
®®= E
)
®®E F
{
©© 	
ResponseDTO
™™ 
response
™™  
=
™™! "
new
™™# &
ResponseDTO
™™' 2
{
™™3 4
	IsExitoso
™™5 >
=
™™? @
false
™™A F
}
™™G H
;
™™H I
string
¨¨ 
folderDownload
¨¨ !
=
¨¨" #
@$"
¨¨$ '
{
¨¨' (
_configuration
¨¨( 6
.
¨¨6 7

GetSection
¨¨7 A
(
¨¨A B
$str
¨¨B P
)
¨¨P Q
.
¨¨Q R

GetSection
¨¨R \
(
¨¨\ ]
$str
¨¨] q
)
¨¨q r
.
¨¨r s
Value
¨¨s x
!
¨¨x y
}
¨¨y z
$str
¨¨z {
"
¨¨{ |
;
¨¨| }
string
≠≠ 
userRoot
≠≠ 
=
≠≠ 
Environment
≠≠ )
.
≠≠) *$
GetEnvironmentVariable
≠≠* @
(
≠≠@ A
$str
≠≠A N
)
≠≠N O
!
≠≠O P
+
≠≠Q R
$str
≠≠S W
;
≠≠W X
var
ÆÆ 
date
ÆÆ 
=
ÆÆ 
DateTime
ÆÆ 
.
ÆÆ  
Now
ÆÆ  #
.
ÆÆ# $
ToString
ÆÆ$ ,
(
ÆÆ, -
$str
ÆÆ- 0
)
ÆÆ0 1
.
ÆÆ1 2
Replace
ÆÆ2 9
(
ÆÆ9 :
$str
ÆÆ: =
,
ÆÆ= >
$str
ÆÆ? B
)
ÆÆB C
;
ÆÆC D
string
ØØ 
fileName
ØØ 
=
ØØ 
$"
ØØ  
{
ØØ  !
userRoot
ØØ! )
}
ØØ) *
{
ØØ* +
folderDownload
ØØ+ 9
}
ØØ9 :
$str
ØØ: M
{
ØØM N
date
ØØN R
}
ØØR S
$str
ØØS W
"
ØØW X
;
ØØX Y
using
±± 
(
±± 
OracleConnection
±± #

connection
±±$ .
=
±±/ 0$
OracleConnectionHelper
±±1 G
.
±±G H
GetConnection
±±H U
(
±±U V
)
±±V W
)
±±W X
{
≤≤ 
await
¥¥ 

connection
¥¥  
.
¥¥  !
	OpenAsync
¥¥! *
(
¥¥* +
)
¥¥+ ,
;
¥¥, -
string
µµ 
strQuery
µµ 
=
µµ  !
@$"
µµ" %
$str
µ∂% %
{
∂∂% &!
_historialTableName
∂∂& 9
}
∂∂9 :
$str
∂∑: ]
"
∑∑] ^
;
∑∑^ _
using
ππ 
(
ππ 
OracleCommand
ππ $
cmd
ππ% (
=
ππ) *
new
ππ+ .
OracleCommand
ππ/ <
(
ππ< =
strQuery
ππ= E
,
ππE F

connection
ππG Q
)
ππQ R
)
ππR S
{
∫∫ 
cmd
ªª 
.
ªª 

Parameters
ªª "
.
ªª" #
Add
ªª# &
(
ªª& '
$str
ªª' 0
,
ªª0 1
OracleDbType
ªª2 >
.
ªª> ?
Varchar2
ªª? G
)
ªªG H
.
ªªH I
Value
ªªI N
=
ªªO P
fileDate
ªªQ Y
;
ªªY Z
using
ΩΩ 
(
ΩΩ 
OracleDataReader
ΩΩ +
reader
ΩΩ, 2
=
ΩΩ3 4
cmd
ΩΩ5 8
.
ΩΩ8 9
ExecuteReader
ΩΩ9 F
(
ΩΩF G
)
ΩΩG H
)
ΩΩH I
{
ææ 
if
øø 
(
øø 
reader
øø "
.
øø" #
Read
øø# '
(
øø' (
)
øø( )
)
øø) *
{
¿¿ 

OracleBlob
¬¬ &
blob
¬¬' +
=
¬¬, -
reader
¬¬. 4
.
¬¬4 5
GetOracleBlob
¬¬5 B
(
¬¬B C
$num
¬¬C D
)
¬¬D E
;
¬¬E F
if
ƒƒ 
(
ƒƒ  
!
ƒƒ  !
reader
ƒƒ! '
.
ƒƒ' (
IsDBNull
ƒƒ( 0
(
ƒƒ0 1
$num
ƒƒ1 2
)
ƒƒ2 3
)
ƒƒ3 4
{
≈≈ 
using
∆∆  %
(
∆∆& '

FileStream
∆∆' 1
fs
∆∆2 4
=
∆∆5 6
new
∆∆7 :

FileStream
∆∆; E
(
∆∆E F
fileName
∆∆F N
,
∆∆N O
FileMode
∆∆P X
.
∆∆X Y
Create
∆∆Y _
)
∆∆_ `
)
∆∆` a
{
««  !
fs
»»$ &
.
»»& '
Write
»»' ,
(
»», -
blob
»»- 1
.
»»1 2
Value
»»2 7
,
»»7 8
$num
»»9 :
,
»»: ;
(
»»< =
int
»»= @
)
»»@ A
blob
»»A E
.
»»E F
Length
»»F L
)
»»L M
;
»»M N
response
……$ ,
.
……, -
	IsExitoso
……- 6
=
……7 8
true
……9 =
;
……= >
response
  $ ,
.
  , -
Mensaje
  - 4
=
  5 6
$"
  7 9
$str
  9 Y
{
  Y Z
fileName
  Z b
}
  b c
"
  c d
;
  d e
response
ÀÀ$ ,
.
ÀÀ, -

StatusCode
ÀÀ- 7
=
ÀÀ8 9
HttpStatusCode
ÀÀ: H
.
ÀÀH I
OK
ÀÀI K
;
ÀÀK L
}
ÃÃ  !
}
ÕÕ 
else
ŒŒ  
{
œœ 
response
——  (
.
——( )
	IsExitoso
——) 2
=
——3 4
false
——5 :
;
——: ;
response
““  (
.
““( )
Mensaje
““) 0
=
““1 2
$"
““3 5
$str
““5 I
{
““I J
fileDate
““J R
}
““R S
$str
““S g
"
““g h
;
““h i
response
””  (
.
””( )

StatusCode
””) 3
=
””4 5
HttpStatusCode
””6 D
.
””D E
NotFound
””E M
;
””M N
}
‘‘ 
}
’’ 
else
÷÷ 
{
◊◊ 
response
ÿÿ $
.
ÿÿ$ %
	IsExitoso
ÿÿ% .
=
ÿÿ/ 0
false
ÿÿ1 6
;
ÿÿ6 7
response
ŸŸ $
.
ŸŸ$ %
Mensaje
ŸŸ% ,
=
ŸŸ- .
$"
ŸŸ/ 1
$str
ŸŸ1 _
{
ŸŸ_ `
fileDate
ŸŸ` h
}
ŸŸh i
"
ŸŸi j
;
ŸŸj k
response
⁄⁄ $
.
⁄⁄$ %

StatusCode
⁄⁄% /
=
⁄⁄0 1
HttpStatusCode
⁄⁄2 @
.
⁄⁄@ A

BadRequest
⁄⁄A K
;
⁄⁄K L
}
€€ 
}
‹‹ 
}
›› 
}
ﬁﬁ 
return
‡‡ 
response
‡‡ 
;
‡‡ 
}
·· 	
private
ÍÍ 
List
ÍÍ 
<
ÍÍ 
OracleParameter
ÍÍ $
>
ÍÍ$ %!
GetOracleParameters
ÍÍ& 9
(
ÍÍ9 :
IEnumerable
ÍÍ: E
<
ÍÍE F
object
ÍÍF L
>
ÍÍL M"
anonymousObjectsList
ÍÍN b
)
ÍÍb c
{
ÎÎ 	
List
ÏÏ 
<
ÏÏ 
OracleParameter
ÏÏ  
>
ÏÏ  !
parameterList
ÏÏ" /
=
ÏÏ0 1
new
ÏÏ2 5
List
ÏÏ6 :
<
ÏÏ: ;
OracleParameter
ÏÏ; J
>
ÏÏJ K
(
ÏÏK L
)
ÏÏL M
;
ÏÏM N
foreach
ÓÓ 
(
ÓÓ 
var
ÓÓ 
anonymousObject
ÓÓ (
in
ÓÓ) +"
anonymousObjectsList
ÓÓ, @
)
ÓÓ@ A
{
ÔÔ 
var
ÒÒ 

properties
ÒÒ 
=
ÒÒ  
anonymousObject
ÒÒ! 0
.
ÒÒ0 1
GetType
ÒÒ1 8
(
ÒÒ8 9
)
ÒÒ9 :
.
ÒÒ: ;
GetProperties
ÒÒ; H
(
ÒÒH I
)
ÒÒI J
;
ÒÒJ K
foreach
ÛÛ 
(
ÛÛ 
var
ÛÛ 
	propiedad
ÛÛ &
in
ÛÛ' )

properties
ÛÛ* 4
)
ÛÛ4 5
{
ÙÙ 
string
ˆˆ 
nombreParametro
ˆˆ *
=
ˆˆ+ ,
$str
ˆˆ- 2
+
ˆˆ3 4
	propiedad
ˆˆ5 >
.
ˆˆ> ?
Name
ˆˆ? C
;
ˆˆC D
object
˜˜ 
valorParametro
˜˜ )
=
˜˜* +
	propiedad
˜˜, 5
.
˜˜5 6
GetValue
˜˜6 >
(
˜˜> ?
anonymousObject
˜˜? N
)
˜˜N O
!
˜˜O P
;
˜˜P Q
OracleParameter
˙˙ #
	parametro
˙˙$ -
=
˙˙. /
new
˙˙0 3
OracleParameter
˙˙4 C
(
˙˙C D
nombreParametro
˙˙D S
,
˙˙S T
valorParametro
˙˙U c
??
˙˙d f
DBNull
˙˙g m
.
˙˙m n
Value
˙˙n s
)
˙˙s t
;
˙˙t u
parameterList
˚˚ !
.
˚˚! "
Add
˚˚" %
(
˚˚% &
	parametro
˚˚& /
)
˚˚/ 0
;
˚˚0 1
}
¸¸ 
}
˝˝ 
return
ˇˇ 
parameterList
ˇˇ  
;
ˇˇ  !
}
ÄÄ 	
private
áá 

Dictionary
áá 
<
áá 
string
áá !
,
áá! "
object
áá# )
>
áá) *#
GetAnonymusParameters
áá+ @
(
áá@ A
IEnumerable
ááA L
<
ááL M
object
ááM S
>
ááS T"
anonymousObjectsList
ááU i
)
áái j
{
àà 	
var
ââ 
parameterList
ââ 
=
ââ 
new
ââ  #

Dictionary
ââ$ .
<
ââ. /
string
ââ/ 5
,
ââ5 6
object
ââ7 =
>
ââ= >
(
ââ> ?
)
ââ? @
{
ââA B
}
ââC D
;
ââD E
foreach
ãã 
(
ãã 
var
ãã 
anonymousObject
ãã (
in
ãã) +"
anonymousObjectsList
ãã, @
)
ãã@ A
{
åå 
var
éé 

properties
éé 
=
éé  
anonymousObject
éé! 0
.
éé0 1
GetType
éé1 8
(
éé8 9
)
éé9 :
.
éé: ;
GetProperties
éé; H
(
ééH I
)
ééI J
;
ééJ K
foreach
êê 
(
êê 
var
êê 
	propiedad
êê &
in
êê' )

properties
êê* 4
)
êê4 5
{
ëë 
string
ìì 
nombreParametro
ìì *
=
ìì+ ,
$str
ìì- 1
+
ìì2 3
	propiedad
ìì4 =
.
ìì= >
Name
ìì> B
;
ììB C
object
îî 
valorParametro
îî )
=
îî* +
	propiedad
îî, 5
.
îî5 6
GetValue
îî6 >
(
îî> ?
anonymousObject
îî? N
)
îîN O
!
îîO P
;
îîP Q
parameterList
óó !
.
óó! "
Add
óó" %
(
óó% &
nombreParametro
óó& 5
,
óó5 6
valorParametro
óó7 E
!
óóE F
)
óóF G
;
óóG H
}
òò 
}
ôô 
return
õõ 
parameterList
õõ  
;
õõ  !
}
úú 	
}
ûû 
}üü ›;
≈D:\Banobras\Sistemas .NET\SST3\SIVARMER\TransicionNvaFSW\Trunk\C√≥digo\RiesgosSimefin_Oracle_2024_05_29\Riesgos.Simefin\Riesgos.Simefin.Infrastructure.Oracle\Repositories\AuthorizationRepository.cs
	namespace 	
Riesgos
 
. 
Simefin 
. 
Infrastructure (
.( )
Oracle) /
./ 0
Repositories0 <
{		 
public 

class #
AuthorizationRepository (
:) *$
IAuthorizationRepository+ C
{ 
private 
readonly 
IConfiguration '
_configuration( 6
;6 7
private 
readonly 
string 
?  
_tokensTableName! 1
=2 3
string4 :
.: ;
Empty; @
;@ A
public #
AuthorizationRepository &
(& '
IConfiguration' 5
configuration6 C
)C D
{ 	
_configuration 
= 
configuration *
;* +
_tokensTableName 
= 
_configuration -
.- .

GetSection. 8
(8 9
$str9 I
)I J
.J K

GetSectionK U
(U V
$strV `
)` a
.a b
Valueb g
!g h
;h i
} 	
public 
async 
Task 
< 
int 
> 
AddAsync '
(' (
Token( -
entity. 4
)4 5
{   	
using!! 
(!! 
var!! 

connection!! !
=!!" #"
OracleConnectionHelper!!$ :
.!!: ;
GetConnection!!; H
(!!H I
)!!I J
)!!J K
{"" 
await## 

connection##  
.##  !
	OpenAsync##! *
(##* +
)##+ ,
;##, -
var$$ 

parameters$$ 
=$$  
new$$! $
{%% 
p_AccessToken&& !
=&&" #
entity&&$ *
.&&* +
AccessToken&&+ 6
,&&6 7
p_ExpirationDate'' $
=''% &
entity''' -
.''- .
ExpirationDate''. <
,''< =
p_RefreshToken)) "
=))# $
entity))% +
.))+ ,
RefreshToken)), 8
,))8 9
p_UsuarioId++ 
=++  !
entity++" (
.++( )
	UsuarioId++) 2
,++2 3
},, 
;,, 
var-- 
query-- 
=-- 
@$"-- 
$str-- +
{--+ ,
_tokensTableName--, <
}--< =
$str-.= e
"..e f
;..f g
var// 
rowsAffected//  
=//! "
await//# (

connection//) 3
.//3 4
ExecuteAsync//4 @
(//@ A
query//A F
,//F G

parameters//H R
)//R S
;//S T
return00 
rowsAffected00 #
;00# $
}11 
}22 	
public44 
Task44 
<44 
bool44 
>44 
DeleteAsync44 %
(44% &
int44& )
id44* ,
)44, -
{55 	
throw66 
new66 #
NotImplementedException66 -
(66- .
)66. /
;66/ 0
}77 	
public== 
async== 
Task== 
<== 
IEnumerable== %
<==% &
Token==& +
>==+ ,
>==, -
GetAllAsync==. 9
(==9 :
)==: ;
{>> 	
using?? 
(?? 
var?? 

connection?? !
=??" #"
OracleConnectionHelper??$ :
.??: ;
GetConnection??; H
(??H I
)??I J
)??J K
{@@ 
awaitAA 

connectionAA  
.AA  !
	OpenAsyncAA! *
(AA* +
)AA+ ,
;AA, -
stringBB 
strQueryBB 
=BB  !
@$"BB" %
$strBC% *
{CC* +
_tokensTableNameCC+ ;
}CC; <
"CC< =
;CC= >
returnDD 
awaitDD 

connectionDD '
.DD' (

QueryAsyncDD( 2
<DD2 3
TokenDD3 8
>DD8 9
(DD9 :
strQueryDD: B
)DDB C
;DDC D
}EE 
}FF 	
publicMM 
asyncMM 
TaskMM 
<MM 
TokenMM 
>MM  
GetByIdAsyncMM! -
(MM- .
intMM. 1
tokenIdMM2 9
)MM9 :
{NN 	
usingOO 
(OO 
OracleConnectionOO #

connectionOO$ .
=OO/ 0"
OracleConnectionHelperOO1 G
.OOG H
GetConnectionOOH U
(OOU V
)OOV W
)OOW X
{PP 
awaitQQ 

connectionQQ  
.QQ  !
	OpenAsyncQQ! *
(QQ* +
)QQ+ ,
;QQ, -
varRR 

parametersRR 
=RR  
newRR! $
{RR% &
p_IdRR' +
=RR, -
tokenIdRR. 5
}RR6 7
;RR7 8
stringSS 
strQuerySS 
=SS  !
@$"SS" %
$strST% *
{TT* +
_tokensTableNameTT+ ;
}TT; <
$strTT< R
"TTR S
;TTS T
varUU 
userUU 
=UU 
awaitUU  

connectionUU! +
.UU+ ,$
QueryFirstOrDefaultAsyncUU, D
<UUD E
TokenUUE J
>UUJ K
(UUK L
strQueryUUL T
,UUT U

parametersUUV `
)UU` a
;UUa b
returnWW 
userWW 
!WW 
;WW 
}XX 
}YY 	
public`` 
async`` 
Task`` 
<`` 
bool`` 
>`` 
UpdateAsync``  +
(``+ ,
Token``, 1
entity``2 8
)``8 9
{aa 	
usingbb 
(bb 
varbb 

connectionbb !
=bb" #"
OracleConnectionHelperbb$ :
.bb: ;
GetConnectionbb; H
(bbH I
)bbI J
)bbJ K
{cc 
awaitdd 

connectiondd  
.dd  !
	OpenAsyncdd! *
(dd* +
)dd+ ,
;dd, -
varee 

parametersee 
=ee  
newee! $
{ff 
p_AccessTokengg !
=gg" #
entitygg$ *
.gg* +
AccessTokengg+ 6
,gg6 7
p_ExpirationDatehh $
=hh% &
entityhh' -
.hh- .
ExpirationDatehh. <
,hh< =
p_RefreshTokenii "
=ii# $
entityii% +
.ii+ ,
RefreshTokenii, 8
,ii8 9
	p_TokenIdjj 
=jj 
entityjj  &
.jj& '
TokenIdjj' .
,jj. /
p_UsuarioIdkk 
=kk  !
entitykk" (
.kk( )
	UsuarioIdkk) 2
}ll 
;ll 
varmm 
querymm 
=mm 
@$"mm 
$strmm &
{mm& '
_tokensTableNamemm' 7
}mm7 8
$strmr8 :
"rr: ;
;rr; <
varss 
affectedRowsss  
=ss! "
awaitss# (

connectionss) 3
.ss3 4
ExecuteAsyncss4 @
(ss@ A
queryssA F
,ssF G

parametersssH R
)ssR S
;ssS T
returntt 
affectedRowstt #
>tt$ %
$numtt& '
;tt' (
}uu 
}vv 	
}ww 
}yy 