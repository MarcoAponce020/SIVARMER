Ûú
ïD:\Banobras\Sistemas .NET\SST3\SIVARMER\TransicionNvaFSW\Trunk\C√≥digo\API_DERIVADOS_ETAPA4_2024_06_06\apiRiesgos\apiRiesgos\Servicios\ServicioApi.cs
	namespace 	

apiRiesgos
 
. 
	Servicios 
{		 
public

 

class

 
ServicioApi

 
:

 
IServicioApi

 +
{ 
private 
readonly 
string 
?  
_grant_type! ,
;, -
private 
readonly 
string 
?  
_scope! '
;' (
private 
readonly 
string 
?  
_urlCom! (
;( )
private 
readonly 
string 
?  
_urlTok! (
;( )
private 
readonly 
string 
?  
_urlRiesgos! ,
;, -
public 
ServicioApi 
( 
) 
{ 	
var 
builder 
= 
new  
ConfigurationBuilder 2
(2 3
)3 4
.4 5
SetBasePath5 @
(@ A
	DirectoryA J
.J K
GetCurrentDirectoryK ^
(^ _
)_ `
)` a
.a b
AddJsonFileb m
(m n
$str	n Ä
)
Ä Å
.
Å Ç
Build
Ç á
(
á à
)
à â
;
â ä
_grant_type 
= 
builder !
.! "

GetSection" ,
(, -
$str- E
)E F
.F G
ValueG L
;L M
_scope 
= 
builder 
. 

GetSection '
(' (
$str( ;
); <
.< =
Value= B
;B C
_urlCom 
= 
builder 
. 

GetSection (
(( )
$str) =
)= >
.> ?
Value? D
;D E
_urlTok 
= 
builder 
. 

GetSection (
(( )
$str) =
)= >
.> ?
Value? D
;D E
_urlRiesgos 
= 
builder !
.! "

GetSection" ,
(, -
$str- E
)E F
.F G
ValueG L
;L M
} 	
public 
async 
Task 
< 
	Respuesta #
># $
Conexion% -
(- .
). /
{ 	
	Respuesta 
	resultado 
=  !
new" %
	Respuesta& /
(/ 0
)0 1
;1 2
	resultado   
.   
exito   
=   
false   #
;  # $
try"" 
{## 
using$$ 
($$ 
var$$ 
client$$ !
=$$" #
new$$$ '

HttpClient$$( 2
($$2 3
)$$3 4
)$$4 5
{%% 
client&& 
.&& 
BaseAddress&& &
=&&' (
new&&) ,
Uri&&- 0
(&&0 1
_urlCom&&1 8
!&&8 9
)&&9 :
;&&: ;
client'' 
.'' !
DefaultRequestHeaders'' 0
.''0 1
Accept''1 7
.''7 8
Clear''8 =
(''= >
)''> ?
;''? @
client(( 
.(( !
DefaultRequestHeaders(( 0
.((0 1
Accept((1 7
.((7 8
Add((8 ;
(((; <
new((< ?+
MediaTypeWithQualityHeaderValue((@ _
(((_ `
$str((` r
)((r s
)((s t
;((t u
HttpResponseMessage** '
response**( 0
=**1 2
await**3 8
client**9 ?
.**? @
GetAsync**@ H
(**H I
$str**I Y
)**Y Z
;**Z [
if++ 
(++ 
response++  
.++  !
IsSuccessStatusCode++! 4
)++4 5
{,, 
	resultado-- !
.--! "
exito--" '
=--( )
true--* .
;--. /
}.. 
else// 
{00 
	resultado11 !
.11! "
mensaje11" )
=11* +
$str11, C
;11C D
}22 
}33 
}44 
catch55 
(55 !
TaskCanceledException55 (
ex55) +
)55+ ,
when55- 1
(552 3
ex553 5
.555 6
InnerException556 D
is55E G
TimeoutException55H X
)55X Y
{66 
	resultado77 
.77 
mensaje77 !
=77" #
$str77$ 1
+772 3
ex774 6
.776 7
Message777 >
;77> ?
}88 
catch99 
(99 !
TaskCanceledException99 (
ex99) +
)99+ ,
{:: 
	resultado;; 
.;; 
mensaje;; !
=;;" #
$str;;$ 0
+;;1 2
ex;;3 5
.;;5 6
Message;;6 =
;;;= >
}<< 
catch== 
(== 
	Exception== 
ex== 
)==  
{>> 
	resultado?? 
.?? 
mensaje?? !
=??" #
ex??$ &
.??& '
Message??' .
;??. /
}@@ 
returnBB 
	resultadoBB 
;BB 
}CC 	
publicEE 
asyncEE 
TaskEE 
<EE 
ResultadoCredencialEE -
>EE- .
AutenticacionEE/ <
(EE< =
stringEE= C
	client_idEED M
,EEM N
stringEEO U
client_secretEEV c
)EEc d
{FF 	
ResultadoCredencialGG 
	resultadoGG  )
=GG* +
newGG, /
ResultadoCredencialGG0 C
{GGD E
exitoGGF K
=GGL M
falseGGN S
}GGT U
;GGU V
AccessTokenResponseHH 
?HH  
tokenHH! &
=HH' (
nullHH) -
;HH- .
tryJJ 
{KK 

HttpClientLL 
clientLL !
=LL" #)
HeadersForAccessTokenGenerateLL$ A
(LLA B
)LLB C
;LLC D
stringNN 
bodyNN 
=NN 
$"NN  
$strNN  +
{NN+ ,
_grant_typeNN, 7
}NN7 8
$strNN8 C
{NNC D
	client_idNND M
}NNM N
$strNNN ]
{NN] ^
client_secretNN^ k
}NNk l
$strNNl s
{NNs t
_scopeNNt z
}NNz {
"NN{ |
;NN| }
clientOO 
.OO 
BaseAddressOO "
=OO# $
newOO% (
UriOO) ,
(OO, -
_urlTokOO- 4
!OO4 5
)OO5 6
;OO6 7
HttpRequestMessagePP "
requestPP# *
=PP+ ,
newPP- 0
HttpRequestMessagePP1 C
(PPC D

HttpMethodPPD N
.PPN O
PostPPO S
,PPS T
clientPPU [
.PP[ \
BaseAddressPP\ g
)PPg h
;PPh i
requestQQ 
.QQ 
ContentQQ 
=QQ  !
newQQ" %
StringContentQQ& 3
(QQ3 4
bodyQQ4 8
,QQ8 9
EncodingRR4 <
.RR< =
UTF8RR= A
,RRA B
$strSS4 W
)SSW X
;SSX Y
ListUU 
<UU 
KeyValuePairUU !
<UU! "
stringUU" (
,UU( )
stringUU* 0
>UU0 1
>UU1 2
postDataUU3 ;
=UU< =
newUU> A
ListUUB F
<UUF G
KeyValuePairUUG S
<UUS T
stringUUT Z
,UUZ [
stringUU\ b
>UUb c
>UUc d
(UUd e
)UUe f
;UUf g
postDataWW 
.WW 
AddWW 
(WW 
newWW  
KeyValuePairWW! -
<WW- .
stringWW. 4
,WW4 5
stringWW6 <
>WW< =
(WW= >
$strWW> J
,WWJ K
_grant_typeWWL W
!WWW X
)WWX Y
)WWY Z
;WWZ [
postDataXX 
.XX 
AddXX 
(XX 
newXX  
KeyValuePairXX! -
<XX- .
stringXX. 4
,XX4 5
stringXX6 <
>XX< =
(XX= >
$strXX> I
,XXI J
	client_idXXK T
)XXT U
)XXU V
;XXV W
postDataYY 
.YY 
AddYY 
(YY 
newYY  
KeyValuePairYY! -
<YY- .
stringYY. 4
,YY4 5
stringYY6 <
>YY< =
(YY= >
$strYY> M
,YYM N
client_secretYYO \
)YY\ ]
)YY] ^
;YY^ _
postDataZZ 
.ZZ 
AddZZ 
(ZZ 
newZZ  
KeyValuePairZZ! -
<ZZ- .
stringZZ. 4
,ZZ4 5
stringZZ6 <
>ZZ< =
(ZZ= >
$strZZ> E
,ZZE F
_scopeZZG M
!ZZM N
)ZZN O
)ZZO P
;ZZP Q
request\\ 
.\\ 
Content\\ 
=\\  !
new\\" %!
FormUrlEncodedContent\\& ;
(\\; <
postData\\< D
)\\D E
;\\E F
HttpResponseMessage]] #
tokenResponse]]$ 1
=]]2 3
client]]4 :
.]]: ;
	PostAsync]]; D
(]]D E
$str]]E Y
,]]Y Z
new]][ ^!
FormUrlEncodedContent]]_ t
(]]t u
postData]]u }
)]]} ~
)]]~ 
.	]] Ä
Result
]]Ä Ü
;
]]Ü á
token__ 
=__ 
await__ 
tokenResponse__ +
.__+ ,
Content__, 3
.__3 4
ReadAsAsync__4 ?
<__? @
AccessTokenResponse__@ S
>__S T
(__T U
new__U X
[__X Y
]__Y Z
{__[ \
new__] `"
JsonMediaTypeFormatter__a w
(__w x
)__x y
}__z {
)__{ |
;__| }
ifaa 
(aa 
tokenaa 
.aa 
AccessTokenaa %
!=aa& (
nullaa) -
)aa- .
{bb 
	resultadocc 
.cc 
tokencc #
=cc$ %
tokencc& +
.cc+ ,
AccessTokencc, 7
;cc7 8
	resultadodd 
.dd 
exitodd #
=dd$ %
truedd& *
;dd* +
}ee 
elseff 
{gg 
	resultadohh 
.hh 
mensajehh %
=hh& '
$strhh( N
;hhN O
}ii 
}jj 
catchkk 
(kk  
HttpRequestExceptionkk '
exkk( *
)kk* +
{ll 
	resultadomm 
.mm 
mensajemm !
=mm" #
$strmm$ -
+mm. /
exmm0 2
.mm2 3
Messagemm3 :
;mm: ;
}nn 
returnpp 
	resultadopp 
;pp 
}qq 	
privatess 

HttpClientss )
HeadersForAccessTokenGeneratess 8
(ss8 9
)ss9 :
{tt 	
HttpClientHandleruu 
handleruu %
=uu& '
newuu( +
HttpClientHandleruu, =
(uu= >
)uu> ?
{uu@ A!
UseDefaultCredentialsuuB W
=uuX Y
falseuuZ _
}uu` a
;uua b

HttpClientvv 
clientvv 
=vv 
newvv  #

HttpClientvv$ .
(vv. /
handlervv/ 6
)vv6 7
;vv7 8
clientxx 
.xx 
BaseAddressxx 
=xx  
newxx! $
Urixx% (
(xx( )
_urlTokxx) 0
!xx0 1
)xx1 2
;xx2 3
clientyy 
.yy !
DefaultRequestHeadersyy (
.yy( )
Acceptyy) /
.yy/ 0
Clearyy0 5
(yy5 6
)yy6 7
;yy7 8
clientzz 
.zz !
DefaultRequestHeaderszz (
.zz( )
Acceptzz) /
.zz/ 0
Addzz0 3
(zz3 4
newzz4 7+
MediaTypeWithQualityHeaderValuezz8 W
(zzW X
$strzzX {
)zz{ |
)zz| }
;zz} ~
return|| 
client|| 
;|| 
}}} 	
public
ÄÄ 
async
ÄÄ 
Task
ÄÄ 
<
ÄÄ 
ResultadoApi
ÄÄ &
>
ÄÄ& '

GetRiesgos
ÄÄ( 2
(
ÄÄ2 3
int
ÄÄ3 6
tipoReporte
ÄÄ7 B
,
ÄÄB C
int
ÄÄD G
fechaConsulta
ÄÄH U
,
ÄÄU V
string
ÄÄW ]
token
ÄÄ^ c
)
ÄÄc d
{
ÅÅ 	
string
ÇÇ 

serviceUrl
ÇÇ 
=
ÇÇ 
_urlRiesgos
ÇÇ  +
+
ÇÇ, -
$str
ÇÇ. <
;
ÇÇ< =
ResultadoApi
ÉÉ 
result
ÉÉ 
=
ÉÉ  !
new
ÉÉ" %
ResultadoApi
ÉÉ& 2
(
ÉÉ2 3
)
ÉÉ3 4
;
ÉÉ4 5
result
ÑÑ 
.
ÑÑ 
mensaje
ÑÑ 
=
ÑÑ 
$str
ÑÑ $
;
ÑÑ$ %
try
ÖÖ 
{
ÜÜ 

HttpClient
áá 
client
áá !
=
áá" #
this
áá$ (
.
áá( )
Method_Headers
áá) 7
(
áá7 8
token
áá8 =
,
áá= >

serviceUrl
áá? I
)
ááI J
;
ááJ K
client
àà 
.
àà 
Timeout
àà 
=
àà  
TimeSpan
àà! )
.
àà) *
FromMilliseconds
àà* :
(
àà: ;
Timeout
àà; B
.
ààB C
Infinite
ààC K
)
ààK L
;
ààL M
string
ää 
urlTmp
ää 
=
ää 
$"
ää  "
{
ää" #
client
ää# )
.
ää) *
BaseAddress
ää* 5
?
ää5 6
.
ää6 7
ToString
ää7 ?
(
ää? @
)
ää@ A
}
ääA B
$str
ääB C
{
ääC D
tipoReporte
ääD O
.
ääO P
ToString
ääP X
(
ääX Y
)
ääY Z
}
ääZ [
$str
ää[ \
{
ää\ ]
fechaConsulta
ää] j
.
ääj k
ToString
ääk s
(
ääs t
)
äät u
}
ääu v
"
ääv w
;
ääw x
Uri
ãã 
myUri
ãã 
=
ãã 
new
ãã 
Uri
ãã  #
(
ãã# $
urlTmp
ãã$ *
)
ãã* +
;
ãã+ ,!
HttpResponseMessage
çç #
tokenResponse
çç$ 1
=
çç2 3
await
çç4 9
client
çç: @
.
çç@ A
GetAsync
ççA I
(
ççI J
myUri
ççJ O
.
ççO P
AbsoluteUri
ççP [
)
çç[ \
;
çç\ ]
if
éé 
(
éé 
tokenResponse
éé !
.
éé! "!
IsSuccessStatusCode
éé" 5
)
éé5 6
{
èè 
result
ëë 
.
ëë 
mensaje
ëë "
=
ëë# $
string
ëë% +
.
ëë+ ,
Empty
ëë, 1
;
ëë1 2
switch
íí 
(
íí 
tipoReporte
íí '
)
íí' (
{
ìì 
case
îî 
$num
îî 
:
îî 
result
ïï "
.
ïï" #$
ListaValuacionReportos
ïï# 9
=
ïï: ;
tokenResponse
ïï< I
.
ïïI J
Content
ïïJ Q
.
ïïQ R
ReadAsAsync
ïïR ]
<
ïï] ^
List
ïï^ b
<
ïïb c
ValuacionReportos
ïïc t
>
ïït u
>
ïïu v
(
ïïv w
new
ïïw z
[
ïïz {
]
ïï{ |
{
ïï} ~
newïï Ç&
JsonMediaTypeFormatterïïÉ ô
(ïïô ö
)ïïö õ
}ïïú ù
)ïïù û
.ïïû ü
Resultïïü •
;ïï• ¶
break
ññ !
;
ññ! "
case
óó 
$num
óó 
:
óó 
result
òò "
.
òò" #"
ListaTenenciaTitulos
òò# 7
=
òò8 9
tokenResponse
òò: G
.
òòG H
Content
òòH O
.
òòO P
ReadAsAsync
òòP [
<
òò[ \
List
òò\ `
<
òò` a
TenenciaTitulos
òòa p
>
òòp q
>
òòq r
(
òòr s
new
òòs v
[
òòv w
]
òòw x
{
òòy z
new
òò{ ~%
JsonMediaTypeFormatteròò ï
(òòï ñ
)òòñ ó
}òòò ô
)òòô ö
.òòö õ
Resultòòõ °
;òò° ¢
break
ôô !
;
ôô! "
case
öö 
$num
öö 
:
öö 
result
õõ "
.
õõ" #$
ListaComprasMesaDinero
õõ# 9
=
õõ: ;
tokenResponse
õõ< I
.
õõI J
Content
õõJ Q
.
õõQ R
ReadAsAsync
õõR ]
<
õõ] ^
List
õõ^ b
<
õõb c
ComprasMesaDinero
õõc t
>
õõt u
>
õõu v
(
õõv w
new
õõw z
[
õõz {
]
õõ{ |
{
õõ} ~
newõõ Ç&
JsonMediaTypeFormatterõõÉ ô
(õõô ö
)õõö õ
}õõú ù
)õõù û
.õõû ü
Resultõõü •
;õõ• ¶
break
úú !
;
úú! "
case
ùù 
$num
ùù 
:
ùù 
result
ûû "
.
ûû" ##
ListaComprasTesoreria
ûû# 8
=
ûû9 :
tokenResponse
ûû; H
.
ûûH I
Content
ûûI P
.
ûûP Q
ReadAsAsync
ûûQ \
<
ûû\ ]
List
ûû] a
<
ûûa b
ComprasTesoreria
ûûb r
>
ûûr s
>
ûûs t
(
ûût u
new
ûûu x
[
ûûx y
]
ûûy z
{
ûû{ |
newûû} Ä&
JsonMediaTypeFormatterûûÅ ó
(ûûó ò
)ûûò ô
}ûûö õ
)ûûõ ú
.ûûú ù
Resultûûù £
;ûû£ §
break
üü !
;
üü! "
case
†† 
$num
†† 
:
†† 
result
°° "
.
°°" #&
ListaPosicionPatrimonial
°°# ;
=
°°< =
tokenResponse
°°> K
.
°°K L
Content
°°L S
.
°°S T
ReadAsAsync
°°T _
<
°°_ `
List
°°` d
<
°°d e!
PosicionPatrimonial
°°e x
>
°°x y
>
°°y z
(
°°z {
new
°°{ ~
[
°°~ 
]°° Ä
{°°Å Ç
new°°É Ü&
JsonMediaTypeFormatter°°á ù
(°°ù û
)°°û ü
}°°† °
)°°° ¢
.°°¢ £
Result°°£ ©
;°°© ™
break
¢¢ !
;
¢¢! "
case
££ 
$num
££ 
:
££ 
break
§§ !
;
§§! "
case
•• 
$num
•• 
:
•• 
result
¶¶ "
.
¶¶" # 
ListaReporteREVAME
¶¶# 5
=
¶¶6 7
tokenResponse
¶¶8 E
.
¶¶E F
Content
¶¶F M
.
¶¶M N
ReadAsAsync
¶¶N Y
<
¶¶Y Z
List
¶¶Z ^
<
¶¶^ _
ReporteRevame
¶¶_ l
>
¶¶l m
>
¶¶m n
(
¶¶n o
new
¶¶o r
[
¶¶r s
]
¶¶s t
{
¶¶u v
new
¶¶w z%
JsonMediaTypeFormatter¶¶{ ë
(¶¶ë í
)¶¶í ì
}¶¶î ï
)¶¶ï ñ
.¶¶ñ ó
Result¶¶ó ù
;¶¶ù û
break
ßß !
;
ßß! "
case
®® 
$num
®® 
:
®® 
result
©© "
.
©©" #%
ListaPosicionCalculoVAR
©©# :
=
©©; <
tokenResponse
©©= J
.
©©J K
Content
©©K R
.
©©R S
ReadAsAsync
©©S ^
<
©©^ _
List
©©_ c
<
©©c d 
PosicionCalculoVar
©©d v
>
©©v w
>
©©w x
(
©©x y
new
©©y |
[
©©| }
]
©©} ~
{©© Ä
new©©Å Ñ&
JsonMediaTypeFormatter©©Ö õ
(©©õ ú
)©©ú ù
}©©û ü
)©©ü †
.©©† °
Result©©° ß
;©©ß ®
break
™™ !
;
™™! "
case
´´ 
$num
´´ 
:
´´ 
result
¨¨ "
.
¨¨" #'
ListaPosicionRegulatorios
¨¨# <
=
¨¨= >
tokenResponse
¨¨? L
.
¨¨L M
Content
¨¨M T
.
¨¨T U
ReadAsAsync
¨¨U `
<
¨¨` a
List
¨¨a e
<
¨¨e f"
PosicionRegulatorios
¨¨f z
>
¨¨z {
>
¨¨{ |
(
¨¨| }
new¨¨} Ä
[¨¨Ä Å
]¨¨Å Ç
{¨¨É Ñ
new¨¨Ö à&
JsonMediaTypeFormatter¨¨â ü
(¨¨ü †
)¨¨† °
}¨¨¢ £
)¨¨£ §
.¨¨§ •
Result¨¨• ´
;¨¨´ ¨
break
≠≠ !
;
≠≠! "
case
ÆÆ 
$num
ÆÆ 
:
ÆÆ  
result
ØØ "
.
ØØ" #+
ListaReportePosicionTesoreria
ØØ# @
=
ØØA B
tokenResponse
ØØC P
.
ØØP Q
Content
ØØQ X
.
ØØX Y
ReadAsAsync
ØØY d
<
ØØd e
List
ØØe i
<
ØØi j'
ReportePosicionTesoreriaØØj Ç
>ØØÇ É
>ØØÉ Ñ
(ØØÑ Ö
newØØÖ à
[ØØà â
]ØØâ ä
{ØØã å
newØØç ê&
JsonMediaTypeFormatterØØë ß
(ØØß ®
)ØØ® ©
}ØØ™ ´
)ØØ´ ¨
.ØØ¨ ≠
ResultØØ≠ ≥
;ØØ≥ ¥
break
∞∞ !
;
∞∞! "
case
±± 
$num
±± 
:
±±  
result
≤≤ "
.
≤≤" #(
ListaPosicionGlobalTitulos
≤≤# =
=
≤≤> ?
tokenResponse
≤≤@ M
.
≤≤M N
Content
≤≤N U
.
≤≤U V
ReadAsAsync
≤≤V a
<
≤≤a b
List
≤≤b f
<
≤≤f g#
PosicionGlobalTitulos
≤≤g |
>
≤≤| }
>
≤≤} ~
(
≤≤~ 
new≤≤ Ç
[≤≤Ç É
]≤≤É Ñ
{≤≤Ö Ü
new≤≤á ä&
JsonMediaTypeFormatter≤≤ã °
(≤≤° ¢
)≤≤¢ £
}≤≤§ •
)≤≤• ¶
.≤≤¶ ß
Result≤≤ß ≠
;≤≤≠ Æ
break
≥≥ !
;
≥≥! "
case
¥¥ 
$num
¥¥ 
:
¥¥  
result
µµ "
.
µµ" #'
ListaMovimientosTesoreria
µµ# <
=
µµ= >
tokenResponse
µµ? L
.
µµL M
Content
µµM T
.
µµT U
ReadAsAsync
µµU `
<
µµ` a
List
µµa e
<
µµe f"
MovimientosTesoreria
µµf z
>
µµz {
>
µµ{ |
(
µµ| }
newµµ} Ä
[µµÄ Å
]µµÅ Ç
{µµÉ Ñ
newµµÖ à&
JsonMediaTypeFormatterµµâ ü
(µµü †
)µµ† °
}µµ¢ £
)µµ£ §
.µµ§ •
Resultµµ• ´
;µµ´ ¨
break
∂∂ !
;
∂∂! "
case
∑∑ 
$num
∑∑ 
:
∑∑  
result
∏∏ "
.
∏∏" ##
ListaPosicionForwards
∏∏# 8
=
∏∏9 :
tokenResponse
∏∏; H
.
∏∏H I
Content
∏∏I P
.
∏∏P Q
ReadAsAsync
∏∏Q \
<
∏∏\ ]
List
∏∏] a
<
∏∏a b
PosicionForwards
∏∏b r
>
∏∏r s
>
∏∏s t
(
∏∏t u
new
∏∏u x
[
∏∏x y
]
∏∏y z
{
∏∏{ |
new∏∏} Ä&
JsonMediaTypeFormatter∏∏Å ó
(∏∏ó ò
)∏∏ò ô
}∏∏ö õ
)∏∏õ ú
.∏∏ú ù
Result∏∏ù £
;∏∏£ §
break
ππ !
;
ππ! "
case
∫∫ 
$num
∫∫ 
:
∫∫  
result
ªª "
.
ªª" #
ListaFlujosSwaps
ªª# 3
=
ªª4 5
tokenResponse
ªª6 C
.
ªªC D
Content
ªªD K
.
ªªK L
ReadAsAsync
ªªL W
<
ªªW X
List
ªªX \
<
ªª\ ]
FlujosSwaps
ªª] h
>
ªªh i
>
ªªi j
(
ªªj k
new
ªªk n
[
ªªn o
]
ªªo p
{
ªªq r
new
ªªs v%
JsonMediaTypeFormatterªªw ç
(ªªç é
)ªªé è
}ªªê ë
)ªªë í
.ªªí ì
Resultªªì ô
;ªªô ö
break
ºº !
;
ºº! "
case
ΩΩ 
$num
ΩΩ 
:
ΩΩ  
result
ææ "
.
ææ" #,
ListaFlujosPosicionesPrimarias
ææ# A
=
ææB C
tokenResponse
ææD Q
.
ææQ R
Content
ææR Y
.
ææY Z
ReadAsAsync
ææZ e
<
ææe f
List
ææf j
<
ææj k(
FlujosPosicionesPrimariasææk Ñ
>ææÑ Ö
>ææÖ Ü
(ææÜ á
newææá ä
[ææä ã
]ææã å
{ææç é
newææè í&
JsonMediaTypeFormatterææì ©
(ææ© ™
)ææ™ ´
}ææ¨ ≠
)ææ≠ Æ
.ææÆ Ø
ResultææØ µ
;ææµ ∂
break
øø !
;
øø! "
case
¿¿ 
$num
¿¿ 
:
¿¿  
result
¡¡ "
.
¡¡" #'
ListaCaracteristicasSwaps
¡¡# <
=
¡¡= >
tokenResponse
¡¡? L
.
¡¡L M
Content
¡¡M T
.
¡¡T U
ReadAsAsync
¡¡U `
<
¡¡` a
List
¡¡a e
<
¡¡e f"
CaracteristicasSwaps
¡¡f z
>
¡¡z {
>
¡¡{ |
(
¡¡| }
new¡¡} Ä
[¡¡Ä Å
]¡¡Å Ç
{¡¡É Ñ
new¡¡Ö à&
JsonMediaTypeFormatter¡¡â ü
(¡¡ü †
)¡¡† °
}¡¡¢ £
)¡¡£ §
.¡¡§ •
Result¡¡• ´
;¡¡´ ¨
break
¬¬ !
;
¬¬! "
case
√√ 
$num
√√ 
:
√√  
result
ƒƒ "
.
ƒƒ" # 
ListaLlamadaMargen
ƒƒ# 5
=
ƒƒ6 7
tokenResponse
ƒƒ8 E
.
ƒƒE F
Content
ƒƒF M
.
ƒƒM N
ReadAsAsync
ƒƒN Y
<
ƒƒY Z
List
ƒƒZ ^
<
ƒƒ^ _
LlamadaMargen
ƒƒ_ l
>
ƒƒl m
>
ƒƒm n
(
ƒƒn o
new
ƒƒo r
[
ƒƒr s
]
ƒƒs t
{
ƒƒu v
new
ƒƒw z%
JsonMediaTypeFormatterƒƒ{ ë
(ƒƒë í
)ƒƒí ì
}ƒƒî ï
)ƒƒï ñ
.ƒƒñ ó
Resultƒƒó ù
;ƒƒù û
break
≈≈ !
;
≈≈! "
case
∆∆ 
$num
∆∆ 
:
∆∆  
result
«« "
.
««" #(
ListaPosicionPrimariaSwaps
««# =
=
««> ?
tokenResponse
««@ M
.
««M N
Content
««N U
.
««U V
ReadAsAsync
««V a
<
««a b
List
««b f
<
««f g#
PosicionPrimariaSwaps
««g |
>
««| }
>
««} ~
(
««~ 
new«« Ç
[««Ç É
]««É Ñ
{««Ö Ü
new««á ä&
JsonMediaTypeFormatter««ã °
(««° ¢
)««¢ £
}««§ •
)««• ¶
.««¶ ß
Result««ß ≠
;««≠ Æ
break
»» !
;
»»! "
case
…… 
$num
…… 
:
……  
result
   "
.
  " #%
ListaOperacionCVDivisas
  # :
=
  ; <
tokenResponse
  = J
.
  J K
Content
  K R
.
  R S
ReadAsAsync
  S ^
<
  ^ _
List
  _ c
<
  c d'
ReporteOperacionCVDivisas
  d }
>
  } ~
>
  ~ 
(   Ä
new  Ä É
[  É Ñ
]  Ñ Ö
{  Ü á
new  à ã&
JsonMediaTypeFormatter  å ¢
(  ¢ £
)  £ §
}  • ¶
)  ¶ ß
.  ß ®
Result  ® Æ
;  Æ Ø
break
ÀÀ !
;
ÀÀ! "
case
ÃÃ 
$num
ÃÃ 
:
ÃÃ  
result
ÕÕ "
.
ÕÕ" #)
ListaPosicionesPrimForwards
ÕÕ# >
=
ÕÕ? @
tokenResponse
ÕÕA N
.
ÕÕN O
Content
ÕÕO V
.
ÕÕV W
ReadAsAsync
ÕÕW b
<
ÕÕb c
List
ÕÕc g
<
ÕÕg h$
PosicionesPrimForwards
ÕÕh ~
>
ÕÕ~ 
>ÕÕ Ä
(ÕÕÄ Å
newÕÕÅ Ñ
[ÕÕÑ Ö
]ÕÕÖ Ü
{ÕÕá à
newÕÕâ å&
JsonMediaTypeFormatterÕÕç £
(ÕÕ£ §
)ÕÕ§ •
}ÕÕ¶ ß
)ÕÕß ®
.ÕÕ® ©
ResultÕÕ© Ø
;ÕÕØ ∞
break
ŒŒ !
;
ŒŒ! "
}
œœ 
}
–– 
else
—— 
{
—— 
result
““ 
.
““ 
mensaje
““ "
=
““# $
tokenResponse
““% 2
.
““2 3
ReasonPhrase
““3 ?
;
““? @
}
”” 
}
‘‘ 
catch
’’ 
(
’’ 
	Exception
’’ 
ex
’’ 
)
’’  
{
÷÷ 
result
◊◊ 
.
◊◊ 
mensaje
◊◊ 
=
◊◊  
this
◊◊! %
.
◊◊% &!
GetExceptionMessage
◊◊& 9
(
◊◊9 :
ex
◊◊: <
)
◊◊< =
;
◊◊= >
}
ÿÿ 
return
⁄⁄ 
result
⁄⁄ 
;
⁄⁄ 
}
€€ 	
private
›› 

HttpClient
›› 
Method_Headers
›› )
(
››) *
string
››* 0
accessToken
››1 <
,
››< =
string
››> D
endpointURL
››E P
)
››P Q
{
ﬁﬁ 	
HttpClientHandler
„„ 
handler
„„ %
=
„„& '
new
„„( +
HttpClientHandler
„„, =
{
‰‰ #
UseDefaultCredentials
ÂÂ %
=
ÂÂ& '
false
ÂÂ( -
,
ÂÂ- .7
)ServerCertificateCustomValidationCallback
ÊÊ 9
=
ÊÊ: ;
(
ÊÊ< =
sender
ÊÊ= C
,
ÊÊC D
cert
ÊÊE I
,
ÊÊI J
chain
ÊÊK P
,
ÊÊP Q
sslPolicyErrors
ÊÊR a
)
ÊÊa b
=>
ÊÊc e
{
ÊÊf g
return
ÊÊh n
true
ÊÊo s
;
ÊÊs t
}
ÊÊu v
}
ÁÁ 
;
ÁÁ 

HttpClient
ÍÍ 
client
ÍÍ 
=
ÍÍ 
new
ÍÍ  #

HttpClient
ÍÍ$ .
(
ÍÍ. /
handler
ÍÍ/ 6
)
ÍÍ6 7
;
ÍÍ7 8
client
ÏÏ 
.
ÏÏ 
BaseAddress
ÏÏ 
=
ÏÏ  
new
ÏÏ! $
Uri
ÏÏ% (
(
ÏÏ( )
endpointURL
ÏÏ) 4
)
ÏÏ4 5
;
ÏÏ5 6
client
ÌÌ 
.
ÌÌ #
DefaultRequestHeaders
ÌÌ (
.
ÌÌ( )
Accept
ÌÌ) /
.
ÌÌ/ 0
Clear
ÌÌ0 5
(
ÌÌ5 6
)
ÌÌ6 7
;
ÌÌ7 8
client
ÓÓ 
.
ÓÓ #
DefaultRequestHeaders
ÓÓ (
.
ÓÓ( )
Accept
ÓÓ) /
.
ÓÓ/ 0
Add
ÓÓ0 3
(
ÓÓ3 4
new
ÓÓ4 7-
MediaTypeWithQualityHeaderValue
ÓÓ8 W
(
ÓÓW X
$str
ÓÓX j
)
ÓÓj k
)
ÓÓk l
;
ÓÓl m
client
ÔÔ 
.
ÔÔ #
DefaultRequestHeaders
ÔÔ (
.
ÔÔ( )
Add
ÔÔ) ,
(
ÔÔ, -
$str
ÔÔ- <
,
ÔÔ< =
$str
ÔÔ> G
+
ÔÔH I
accessToken
ÔÔJ U
)
ÔÔU V
;
ÔÔV W
return
ÒÒ 
client
ÒÒ 
;
ÒÒ 
}
ÚÚ 	
public
ÙÙ 
async
ÙÙ 
Task
ÙÙ 
<
ÙÙ 
ResultadoApi
ÙÙ &
>
ÙÙ& '
GetRiesgosRango
ÙÙ( 7
(
ÙÙ7 8
int
ÙÙ8 ;
tipoReporte
ÙÙ< G
,
ÙÙG H
int
ÙÙI L
fechaIni
ÙÙM U
,
ÙÙU V
int
ÙÙW Z
fechaFin
ÙÙ[ c
,
ÙÙc d
string
ÙÙe k
token
ÙÙl q
)
ÙÙq r
{
ıı 	
string
ˆˆ 

serviceUrl
ˆˆ 
=
ˆˆ 
_urlRiesgos
ˆˆ  +
+
ˆˆ, -
$str
ˆˆ. <
;
ˆˆ< =
ResultadoApi
˜˜ 
resp
˜˜ 
=
˜˜ 
new
˜˜  #
ResultadoApi
˜˜$ 0
(
˜˜0 1
)
˜˜1 2
;
˜˜2 3
try
¯¯ 
{
˘˘ 
string
˙˙ )
getSecurityQuestionEndPoint
˙˙ 2
=
˙˙3 4

serviceUrl
˙˙5 ?
;
˙˙? @

HttpClient
¸¸ 
client
¸¸ !
=
¸¸" #
this
¸¸$ (
.
¸¸( )
Method_Headers
¸¸) 7
(
¸¸7 8
token
¸¸8 =
,
¸¸= >)
getSecurityQuestionEndPoint
¸¸? Z
)
¸¸Z [
;
¸¸[ \
string
ÅÅ 
urlTemp
ÅÅ 
=
ÅÅ  
$"
ÅÅ! #
{
ÅÅ# $
client
ÅÅ$ *
.
ÅÅ* +
BaseAddress
ÅÅ+ 6
?
ÅÅ6 7
.
ÅÅ7 8
ToString
ÅÅ8 @
(
ÅÅ@ A
)
ÅÅA B
}
ÅÅB C
$str
ÅÅC D
{
ÅÅD E
tipoReporte
ÅÅE P
.
ÅÅP Q
ToString
ÅÅQ Y
(
ÅÅY Z
)
ÅÅZ [
}
ÅÅ[ \
$str
ÅÅ\ ]
{
ÅÅ] ^
fechaIni
ÅÅ^ f
.
ÅÅf g
ToString
ÅÅg o
(
ÅÅo p
)
ÅÅp q
}
ÅÅq r
$str
ÅÅr s
{
ÅÅs t
fechaFin
ÅÅt |
.
ÅÅ| }
ToStringÅÅ} Ö
(ÅÅÖ Ü
)ÅÅÜ á
}ÅÅá à
"ÅÅà â
;ÅÅâ ä!
HttpResponseMessage
ÇÇ #
tokenResponse
ÇÇ$ 1
=
ÇÇ2 3
await
ÇÇ4 9
client
ÇÇ: @
.
ÇÇ@ A
GetAsync
ÇÇA I
(
ÇÇI J
Uri
ÇÇJ M
.
ÇÇM N
EscapeDataString
ÇÇN ^
(
ÇÇ^ _
urlTemp
ÇÇ_ f
)
ÇÇf g
)
ÇÇg h
;
ÇÇh i
if
ÑÑ 
(
ÑÑ 
tipoReporte
ÑÑ 
==
ÑÑ  "
$num
ÑÑ# $
)
ÑÑ$ %
{
ÖÖ 
resp
ÜÜ 
.
ÜÜ (
ListaComprasVentasOperador
ÜÜ 3
=
ÜÜ4 5
tokenResponse
ÜÜ6 C
.
ÜÜC D
Content
ÜÜD K
.
ÜÜK L
ReadAsAsync
ÜÜL W
<
ÜÜW X
List
ÜÜX \
<
ÜÜ\ ]#
ComprasVentasOperador
ÜÜ] r
>
ÜÜr s
>
ÜÜs t
(
ÜÜt u
new
ÜÜu x
[
ÜÜx y
]
ÜÜy z
{
ÜÜ{ |
newÜÜ} Ä&
JsonMediaTypeFormatterÜÜÅ ó
(ÜÜó ò
)ÜÜò ô
}ÜÜö õ
)ÜÜõ ú
.ÜÜú ù
ResultÜÜù £
;ÜÜ£ §
}
áá 
}
àà 
catch
ââ 
(
ââ 
	Exception
ââ 
ex
ââ 
)
ââ  
{
ää 
resp
ãã 
.
ãã 
mensaje
ãã 
=
ãã 
ex
ãã !
.
ãã! "
Message
ãã" )
;
ãã) *
}
åå 
return
çç 
resp
çç 
;
çç 
}
éé 	
public
êê 
string
êê !
GetExceptionMessage
êê )
(
êê) *
	Exception
êê* 3
	exception
êê4 =
)
êê= >
{
ëë 	
StringBuilder
íí 
	sbMessage
íí #
=
íí$ %
new
íí& )
StringBuilder
íí* 7
(
íí7 8
	exception
íí8 A
.
ííA B
Message
ííB I
)
ííI J
;
ííJ K
while
ìì 
(
ìì 
	exception
ìì 
?
ìì 
.
ìì 
InnerException
ìì ,
!=
ìì- /
null
ìì0 4
)
ìì4 5
{
îî 
	sbMessage
ïï 
.
ïï 
Append
ïï  
(
ïï  !
$str
ïï! $
+
ïï% &
	exception
ïï' 0
.
ïï0 1
InnerException
ïï1 ?
.
ïï? @
Message
ïï@ G
)
ïïG H
;
ïïH I
	exception
ññ 
=
ññ 
	exception
ññ %
.
ññ% &
InnerException
ññ& 4
!
ññ4 5
;
ññ5 6
}
óó 
return
ôô 
	sbMessage
ôô 
.
ôô 
ToString
ôô %
(
ôô% &
)
ôô& '
;
ôô' (
}
öö 	
}
úú 
}ùù ˇ

ñD:\Banobras\Sistemas .NET\SST3\SIVARMER\TransicionNvaFSW\Trunk\C√≥digo\API_DERIVADOS_ETAPA4_2024_06_06\apiRiesgos\apiRiesgos\Servicios\IServicioApi.cs
	namespace 	

apiRiesgos
 
. 
	Servicios 
{ 
public 

	interface 
IServicioApi !
{ 
Task 
< 
	Respuesta 
> 
Conexion  
(  !
)! "
;" #
Task		 
<		 
ResultadoCredencial		  
>		  !
Autenticacion		" /
(		/ 0
string		0 6
	client_id		7 @
,		@ A
string		B H
client_secret		I V
)		V W
;		W X
Task 
< 
ResultadoApi 
> 

GetRiesgos %
(% &
int& )
tipoReporte* 5
,5 6
int7 :
fechaConsulta; H
,H I
stringJ P
tokenQ V
)V W
;W X
Task 
< 
ResultadoApi 
> 
GetRiesgosRango *
(* +
int+ .
tipoReporte/ :
,: ;
int< ?
fechaIni@ H
,H I
intJ M
fechaFinN V
,V W
stringX ^
token_ d
)d e
;e f
} 
} â
áD:\Banobras\Sistemas .NET\SST3\SIVARMER\TransicionNvaFSW\Trunk\C√≥digo\API_DERIVADOS_ETAPA4_2024_06_06\apiRiesgos\apiRiesgos\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. 
AddControllers 
(  
)  !
;! "
builder

 
.

 
Services

 
.

 #
AddEndpointsApiExplorer

 (
(

( )
)

) *
;

* +
builder 
. 
Services 
. 
AddSwaggerGen 
( 
)  
;  !
builder 
. 
Services 
. 
	AddScoped 
< 
IServicioApi '
,' (
ServicioApi) 4
>4 5
(5 6
)6 7
;7 8
IConfiguration 
config 
= 
new  
ConfigurationBuilder 0
(0 1
)1 2
. 
AddJsonFile 
( 
$str #
)# $
. #
AddEnvironmentVariables 
( 
) 
. 
Build 

(
 
) 
; 
builder 
. 
Configuration 
. 
AddUserSecrets $
<$ %
Program% ,
>, -
(- .
). /
;/ 0
var 
app 
= 	
builder
 
. 
Build 
( 
) 
; 
if 
( 
app 
. 
Environment 
. 
IsProduction  
(  !
)! "
||# %
app& )
.) *
Environment* 5
.5 6
	IsStaging6 ?
(? @
)@ A
)A B
{ 
app 
. 
UseExceptionHandler 
( 
$str /
)/ 0
;0 1
}   
app## 
.## 

UseSwagger## 
(## 
c## 
=>## 
{$$ 
c%% 
.%% 
RouteTemplate%% 
=%% 
$str%% ;
;%%; <
}&& 
)&& 
;&& 
app(( 
.(( 
UseSwaggerUI(( 
((( 
c(( 
=>(( 
{)) 
c** 
.** 
RoutePrefix** 
=** 
$str** 
;** 
c++ 
.++ 
SwaggerEndpoint++ 
(++ 
$str++ 0
,++0 1
$str++2 :
)++: ;
;++; <
}.. 
).. 
;.. 
app00 
.00 
Use00 
(00 
async00 
(00 
ctx00 
,00 
next00 
)00 
=>00 
{11 
await22 
next22 
(22 
)22 
;22 
if33 

(33 
ctx33 
.33 
Response33 
.33 

StatusCode33 #
==33$ &
$num33' *
)33* +
{44 	
ctx55 
.55 
Response55 
.55 
ContentLength55 &
=55' (
$num55) *
;55* +
}66 	
}77 
)77 
;77 
app99 
.99 
UseHttpsRedirection99 
(99 
)99 
;99 
app;; 
.;; 
UseAuthorization;; 
(;; 
);; 
;;; 
app== 
.== 
MapControllers== 
(== 
)== 
;== 
await?? 
app?? 	
.??	 

RunAsync??
 
(?? 
)?? 
;?? •
ìD:\Banobras\Sistemas .NET\SST3\SIVARMER\TransicionNvaFSW\Trunk\C√≥digo\API_DERIVADOS_ETAPA4_2024_06_06\apiRiesgos\apiRiesgos\GetOracleConnection.cs
	namespace 	

apiRiesgos
 
{ 
public 

class 
GetOracleConnection $
{ 
private		 
readonly		 
IConfiguration		 '
_configuration		( 6
;		6 7
public 
GetOracleConnection "
(" #
IConfiguration# 1
configuration2 ?
)? @
=>A C
_configurationD R
=S T
configurationU b
;b c
public 
OracleConnection 
GetConnection  -
(- .
string. 4
source5 ;
); <
{ 	
string 
environmentVariable &
=' (
string) /
./ 0
Empty0 5
;5 6
switch 
( 
source 
) 
{ 
case 
EnumDataBaseTypes &
.& '
	DERIVADOS' 0
:0 1
environmentVariable '
=( )
_configuration* 8
!8 9
.9 :

GetSection: D
(D E
$strE ]
)] ^
.^ _
Value_ d
!d e
;e f
break 
; 
case 
EnumDataBaseTypes &
.& '
VARMER' -
:- .
environmentVariable '
=( )
_configuration* 8
!8 9
.9 :

GetSection: D
(D E
$strE ]
)] ^
.^ _
Value_ d
!d e
;e f
break 
; 
} 
string $
environmentVariableValue +
=, -
Environment. 9
.9 :"
GetEnvironmentVariable: P
(P Q
environmentVariableQ d
)d e
!e f
;f g
if 
( 
! 
string 
. 
IsNullOrEmpty %
(% &$
environmentVariableValue& >
)> ?
)? @
{ 
var 
data 
= 
JsonConvert &
.& '
DeserializeObject' 8
<8 9(
DataBaseEnvironmentVariables9 U
>U V
(V W$
environmentVariableValueW o
!o p
)p q
;q r
string 
connectionString '
=( )
_configuration* 8
!8 9
.9 :

GetSection: D
(D E
$strE X
)X Y
.Y Z

GetSectionZ d
(d e
$stre u
)u v
.v w
Valuew |
!| }
;} ~
string !
valueConnectionString ,
=- .
string/ 5
.5 6
Format6 <
(< =
connectionString= M
,M N
dataO S
!S T
.T U
ServerNameOrIPU c
,c d
datae i
.i j
Portj n
,n o
datap t
.t u
Schemeu {
,{ |
data	} Å
.
Å Ç
UserId
Ç à
,
à â
data
ä é
.
é è
Password
è ó
)
ó ò
;
ò ô
var   

connection   
=    
new  ! $
OracleConnection  % 5
(  5 6!
valueConnectionString  6 K
)  K L
;  L M
return"" 

connection"" !
;""! "
}## 
return%% 
new%% 
OracleConnection%% '
(%%' (
)%%( )
;%%) *
}&& 	
}(( 
})) ‘
ëD:\Banobras\Sistemas .NET\SST3\SIVARMER\TransicionNvaFSW\Trunk\C√≥digo\API_DERIVADOS_ETAPA4_2024_06_06\apiRiesgos\apiRiesgos\EnumDataBaseTypes.cs
	namespace 	

apiRiesgos
 
{ 
public 

static 
class 
EnumDataBaseTypes )
{ 
public 
const 
string 
	DERIVADOS %
=& '
$str( 3
;3 4
public		 
const		 
string		 
VARMER		 "
=		# $
$str		% -
;		- .
} 
} ˝Ø
ùD:\Banobras\Sistemas .NET\SST3\SIVARMER\TransicionNvaFSW\Trunk\C√≥digo\API_DERIVADOS_ETAPA4_2024_06_06\apiRiesgos\apiRiesgos\Controllers\RiesgosController.cs
	namespace 	

apiRiesgos
 
. 
Controllers  
{ 
[		 
Route		 

(		
 
$str		 
)		 
]		 
[

 
ApiController

 
]

 
public 

class 
RiesgosController "
:# $
ControllerBase% 3
{ 
private 
readonly 
IServicioApi %
_servicioApi& 2
;2 3
private 
readonly 
ILogger  
<  !
RiesgosController! 2
>2 3
_logger4 ;
;; <
private 
readonly 
IConfiguration '
configuration( 5
;5 6
private 
readonly 
OracleConnection )
?) *
conn+ /
;/ 0
private 
readonly 
OracleConnection )
?) *
connDerivados+ 8
;8 9
public 
RiesgosController  
(  !
IServicioApi! -
servicioApi. 9
,9 :
ILogger; B
<B C
RiesgosControllerC T
>T U
loggerV \
,\ ]
IConfiguration^ l
_configurationm {
){ |
{ 	
_servicioApi 
= 
servicioApi &
;& '
_logger 
= 
logger 
; 
configuration 
= 
_configuration *
;* +
GetOracleConnection 
getOracleConnection  3
;3 4
	Respuesta 

respuesta1  
=! "
new# &
	Respuesta' 0
(0 1
)1 2
;2 3
try 
{ 
getOracleConnection #
=$ %
new& )
GetOracleConnection* =
(= >
configuration> K
)K L
;L M
conn 
= 
getOracleConnection *
.* +
GetConnection+ 8
(8 9
EnumDataBaseTypes9 J
.J K
VARMERK Q
)Q R
;R S
connDerivados 
= 
getOracleConnection  3
.3 4
GetConnection4 A
(A B
EnumDataBaseTypesB S
.S T
	DERIVADOST ]
)] ^
;^ _
} 
catch   
(   
	Exception   
ex   
)    
{!! 

respuesta1"" 
."" 
mensaje"" "
=""# $
ex""% '
.""' (
Message""( /
;""/ 0
}## 
}$$ 	
['' 	
HttpGet''	 
('' 
$str'' 8
)''8 9
]''9 :
public(( 
async(( 
Task(( 
<(( 
	Respuesta(( #
>((# $

GetRiesgos((% /
(((/ 0
int((0 3
tipoReporte((4 ?
,((? @
int((A D
fechaConsulta((E R
,((R S
string((T Z
token(([ `
)((` a
{)) 	
	Respuesta** 
	respuesta** 
=**  !
new**" %
	Respuesta**& /
(**/ 0
)**0 1
;**1 2
	respuesta++ 
.++ 
exito++ 
=++ 
false++ #
;++# $
	respuesta,, 
.,, 
mensaje,, 
=,, 
$str,,  `
;,,` a
ResultadoApi-- 
respuestaAPI-- %
=--& '
new--( +
ResultadoApi--, 8
(--8 9
)--9 :
;--: ;
try// 
{00 
respuestaAPI11 
=11 
await11 $
_servicioApi11% 1
.111 2

GetRiesgos112 <
(11< =
tipoReporte11= H
,11H I
fechaConsulta11J W
,11W X
token11Y ^
)11^ _
;11_ `
if44 
(44 
!44 
string44 
.44 
IsNullOrEmpty44 )
(44) *
respuestaAPI44* 6
.446 7
mensaje447 >
)44> ?
)44? @
{55 
	respuesta66 
.66 
mensaje66 %
=66& '
respuestaAPI66( 4
.664 5
mensaje665 <
;66< =
}77 
else88 
{99 
var:: 
catalogo_divisas_R:: *
=::+ ,
new::- 0

DALRiesgos::1 ;
(::; <
)::< =
.::= >
GetCatalogoDivisas::> P
(::P Q
$str::Q [
,::[ \
conn::] a
!::a b
)::b c
;::c d
var;; 
catalogo_divisas_D;; *
=;;+ ,
new;;- 0

DALRiesgos;;1 ;
(;;; <
);;< =
.;;= >
GetCatalogoDivisas;;> P
(;;P Q
$str;;Q Y
,;;Y Z
connDerivados;;[ h
!;;h i
);;i j
;;;j k
var<< 
catalogo_posiciones<< +
=<<, -
new<<. 1

DALRiesgos<<2 <
(<<< =
)<<= >
.<<> ?!
GetCatalogoPosiciones<<? T
(<<T U
conn<<U Y
!<<Y Z
)<<Z [
;<<[ \
switch>> 
(>> 
tipoReporte>> '
)>>' (
{?? 
case@@ 
$num@@ 
:@@ 
ifAA 
(AA  
respuestaAPIAA  ,
.AA, -"
ListaValuacionReportosAA- C
!=AAD F
nullAAG K
)AAK L
{BB 
	respuestaCC  )
=CC* +
newCC, /

DALRiesgosCC0 :
(CC: ;
)CC; <
.CC< =$
guardarValuacionReportosCC= U
(CCU V
respuestaAPICCV b
.CCb c"
ListaValuacionReportosCCc y
,CCy z
connCC{ 
!	CC Ä
)
CCÄ Å
;
CCÅ Ç
}DD 
breakEE !
;EE! "
caseFF 
$numFF 
:FF 
ifGG 
(GG  
respuestaAPIGG  ,
.GG, - 
ListaTenenciaTitulosGG- A
!=GGB D
nullGGE I
)GGI J
{HH 
	respuestaII  )
=II* +
newII, /

DALRiesgosII0 :
(II: ;
)II; <
.II< ="
guardarTenenciaTitulosII= S
(IIS T
respuestaAPIIIT `
.II` a 
ListaTenenciaTitulosIIa u
,IIu v
connIIw {
!II{ |
)II| }
;II} ~
}JJ 
breakKK !
;KK! "
caseLL 
$numLL 
:LL 
ifMM 
(MM  
respuestaAPIMM  ,
.MM, -"
ListaComprasMesaDineroMM- C
!=MMD F
nullMMG K
)MMK L
{NN 
	respuestaOO  )
=OO* +
newOO, /

DALRiesgosOO0 :
(OO: ;
)OO; <
.OO< =$
guardarComprasMesaDineroOO= U
(OOU V
respuestaAPIOOV b
.OOb c"
ListaComprasMesaDineroOOc y
,OOy z
connOO{ 
!	OO Ä
)
OOÄ Å
;
OOÅ Ç
}PP 
breakQQ !
;QQ! "
caseRR 
$numRR 
:RR 
ifSS 
(SS  
respuestaAPISS  ,
.SS, -!
ListaComprasTesoreriaSS- B
!=SSC E
nullSSF J
)SSJ K
{TT 
	respuestaUU  )
=UU* +
newUU, /

DALRiesgosUU0 :
(UU: ;
)UU; <
.UU< =#
guardarComprasTesoreriaUU= T
(UUT U
respuestaAPIUUU a
.UUa b!
ListaComprasTesoreriaUUb w
,UUw x
connUUy }
!UU} ~
)UU~ 
;	UU Ä
}VV 
breakWW !
;WW! "
caseXX 
$numXX 
:XX 
ifYY 
(YY  
respuestaAPIYY  ,
.YY, -$
ListaPosicionPatrimonialYY- E
!=YYF H
nullYYI M
)YYM N
{ZZ 
	respuesta[[  )
=[[* +
new[[, /

DALRiesgos[[0 :
([[: ;
)[[; <
.[[< =&
guardarPosicionPatrimonial[[= W
([[W X
respuestaAPI[[X d
.[[d e$
ListaPosicionPatrimonial[[e }
,[[} ~
conn	[[ É
!
[[É Ñ
)
[[Ñ Ö
;
[[Ö Ü
}\\ 
break]] !
;]]! "
case^^ 
$num^^ 
:^^ 
break__ !
;__! "
case`` 
$num`` 
:`` 
ifaa 
(aa  
respuestaAPIaa  ,
.aa, -
ListaReporteREVAMEaa- ?
!=aa@ B
nullaaC G
)aaG H
{bb 
	respuestacc  )
=cc* +
newcc, /

DALRiesgoscc0 :
(cc: ;
)cc; <
.cc< = 
guardarReporteREVAMEcc= Q
(ccQ R
respuestaAPIccR ^
.cc^ _
ListaReporteREVAMEcc_ q
,ccq r
connccs w
!ccw x
)ccx y
;ccy z
}dd 
breakee !
;ee! "
caseff 
$numff 
:ff 
ifgg 
(gg  
respuestaAPIgg  ,
.gg, -#
ListaPosicionCalculoVARgg- D
!=ggE G
nullggH L
)ggL M
{hh 
	respuestaii  )
=ii* +
newii, /

DALRiesgosii0 :
(ii: ;
)ii; <
.ii< =%
guardarPosicionCalculoVARii= V
(iiV W
respuestaAPIiiW c
.iic d#
ListaPosicionCalculoVARiid {
,ii{ |
conn	ii} Å
!
iiÅ Ç
)
iiÇ É
;
iiÉ Ñ
}jj 
breakkk !
;kk! "
casell 
$numll 
:ll 
ifmm 
(mm  
respuestaAPImm  ,
.mm, -%
ListaPosicionRegulatoriosmm- F
!=mmG I
nullmmJ N
)mmN O
{nn 
	respuestaoo  )
=oo* +
newoo, /

DALRiesgosoo0 :
(oo: ;
)oo; <
.oo< ='
guardarPosicionRegulatoriosoo= X
(ooX Y
respuestaAPIooY e
.ooe f%
ListaPosicionRegulatoriosoof 
,	oo Ä
conn
ooÅ Ö
!
ooÖ Ü
)
ooÜ á
;
ooá à
}pp 
breakqq !
;qq! "
caserr 
$numrr 
:rr  
ifss 
(ss  
respuestaAPIss  ,
.ss, -)
ListaReportePosicionTesoreriass- J
!=ssK M
nullssN R
)ssR S
{tt 
	respuestauu  )
=uu* +
newuu, /

DALRiesgosuu0 :
(uu: ;
)uu; <
.uu< =+
guardarReportePosicionTesoreriauu= \
(uu\ ]
respuestaAPIuu] i
.uui j*
ListaReportePosicionTesoreria	uuj á
,
uuá à
conn
uuâ ç
!
uuç é
)
uué è
;
uuè ê
}vv 
breakww !
;ww! "
casexx 
$numxx 
:xx  
ifyy 
(yy  
respuestaAPIyy  ,
.yy, -&
ListaPosicionGlobalTitulosyy- G
!=yyH J
nullyyK O
)yyO P
{zz 
	respuesta{{  )
={{* +
new{{, /

DALRiesgos{{0 :
({{: ;
){{; <
.{{< = 
guardarGlobalTitulos{{= Q
({{Q R
respuestaAPI{{R ^
.{{^ _&
ListaPosicionGlobalTitulos{{_ y
,{{y z
conn{{{ 
!	{{ Ä
)
{{Ä Å
;
{{Å Ç
}|| 
break}} !
;}}! "
case~~ 
$num~~ 
:~~  
if 
(  
respuestaAPI  ,
., -%
ListaMovimientosTesoreria- F
!=G I
nullJ N
)N O
{
ÄÄ 
	respuesta
ÅÅ  )
=
ÅÅ* +
new
ÅÅ, /

DALRiesgos
ÅÅ0 :
(
ÅÅ: ;
)
ÅÅ; <
.
ÅÅ< =)
guardarMovimientosTesoreria
ÅÅ= X
(
ÅÅX Y
respuestaAPI
ÅÅY e
.
ÅÅe f'
ListaMovimientosTesoreria
ÅÅf 
,ÅÅ Ä
connÅÅÅ Ö
!ÅÅÖ Ü
)ÅÅÜ á
;ÅÅá à
}
ÇÇ 
break
ÉÉ !
;
ÉÉ! "
case
ÑÑ 
$num
ÑÑ 
:
ÑÑ  
if
ÖÖ 
(
ÖÖ  
respuestaAPI
ÖÖ  ,
.
ÖÖ, -#
ListaPosicionForwards
ÖÖ- B
!=
ÖÖC E
null
ÖÖF J
)
ÖÖJ K
{
ÜÜ 
	respuesta
áá  )
=
áá* +
new
áá, /

DALRiesgos
áá0 :
(
áá: ;
)
áá; <
.
áá< =%
guardarPosicionForwards
áá= T
(
ááT U
respuestaAPI
ááU a
.
ááa b#
ListaPosicionForwards
ááb w
,
ááw x
connDerivadosááy Ü
!ááÜ á
)ááá à
;ááà â
}
àà 
break
ââ !
;
ââ! "
case
ää 
$num
ää 
:
ää  
if
ãã 
(
ãã  
respuestaAPI
ãã  ,
.
ãã, -
ListaFlujosSwaps
ãã- =
!=
ãã> @
null
ããA E
)
ããE F
{
åå 
	respuesta
çç  )
=
çç* +
new
çç, /

DALRiesgos
çç0 :
(
çç: ;
)
çç; <
.
çç< = 
guardarFlujosSwaps
çç= O
(
ççO P
respuestaAPI
ççP \
.
çç\ ]
ListaFlujosSwaps
çç] m
,
ççm n!
catalogo_divisas_Dçço Å
,ççÅ Ç
connDerivadosççÉ ê
!ççê ë
)ççë í
;ççí ì
}
éé 
break
èè !
;
èè! "
case
êê 
$num
êê 
:
êê  
if
ëë 
(
ëë  
respuestaAPI
ëë  ,
.
ëë, -,
ListaFlujosPosicionesPrimarias
ëë- K
!=
ëëL N
null
ëëO S
&&
ëëT V
respuestaAPI
ëëW c
.
ëëc d-
ListaFlujosPosicionesPrimariasëëd Ç
.ëëÇ É
CountëëÉ à
>ëëâ ä
$numëëã å
)ëëå ç
{
íí 
	respuesta
ìì  )
=
ìì* +
await
ìì, 1
new
ìì2 5

DALRiesgos
ìì6 @
(
ìì@ A
)
ììA B
.
ììB C.
 FlujosPosicionesPrimariasProcess
ììC c
(
ììc d
fechaConsulta
ììd q
,
ììq r
respuestaAPI
ììs 
.ìì Ä.
ListaFlujosPosicionesPrimariasììÄ û
,ììû ü
connìì† §
!ìì§ •
)ìì• ¶
;ìì¶ ß
}
îî 
break
ïï !
;
ïï! "
case
ññ 
$num
ññ 
:
ññ  
if
óó 
(
óó  
respuestaAPI
óó  ,
.
óó, -'
ListaCaracteristicasSwaps
óó- F
!=
óóG I
null
óóJ N
)
óóN O
{
òò 
	respuesta
ôô  )
=
ôô* +
new
ôô, /

DALRiesgos
ôô0 :
(
ôô: ;
)
ôô; <
.
ôô< =)
guardarCaracteristicasSwaps
ôô= X
(
ôôX Y
respuestaAPI
ôôY e
.
ôôe f'
ListaCaracteristicasSwaps
ôôf 
,ôô Ä"
catalogo_divisas_DôôÅ ì
,ôôì î
connDerivadosôôï ¢
!ôô¢ £
)ôô£ §
;ôô§ •
}
öö 
break
õõ !
;
õõ! "
case
úú 
$num
úú 
:
úú  
if
ùù 
(
ùù  
respuestaAPI
ùù  ,
.
ùù, - 
ListaLlamadaMargen
ùù- ?
!=
ùù@ B
null
ùùC G
)
ùùG H
{
ûû 
	respuesta
üü  )
=
üü* +
new
üü, /

DALRiesgos
üü0 :
(
üü: ;
)
üü; <
.
üü< ="
guardarLlamadaMargen
üü= Q
(
üüQ R
respuestaAPI
üüR ^
.
üü^ _ 
ListaLlamadaMargen
üü_ q
,
üüq r
conn
üüs w
!
üüw x
)
üüx y
;
üüy z
}
†† 
break
°° !
;
°°! "
case
¢¢ 
$num
¢¢ 
:
¢¢  
if
££ 
(
££  
respuestaAPI
££  ,
.
££, -(
ListaPosicionPrimariaSwaps
££- G
!=
££H J
null
££K O
&&
££P R
respuestaAPI
££S _
.
££_ `(
ListaPosicionPrimariaSwaps
££` z
.
££z {
Count££{ Ä
>££Å Ç
$num££É Ñ
)££Ñ Ö
{
§§ 
	respuesta
••  )
=
••* +
await
••, 1
new
••2 5

DALRiesgos
••6 @
(
••@ A
)
••A B
.
••B C*
guardarPosicionPrimariaSwaps
••C _
(
••_ `
fechaConsulta
••` m
,
••m n
respuestaAPI
••o {
.
••{ |)
ListaPosicionPrimariaSwaps••| ñ
,••ñ ó
conn••ò ú
!••ú ù
)••ù û
;••û ü
}
¶¶ 
break
ßß !
;
ßß! "
case
®® 
$num
®® 
:
®®  
if
©© 
(
©©  
respuestaAPI
©©  ,
.
©©, -%
ListaOperacionCVDivisas
©©- D
!=
©©E G
null
©©H L
)
©©L M
{
™™ 
	respuesta
´´  )
=
´´* +
new
´´, /

DALRiesgos
´´0 :
(
´´: ;
)
´´; <
.
´´< =.
 guardarReporteOperacionCVDivisas
´´= ]
(
´´] ^
respuestaAPI
´´^ j
.
´´j k&
ListaOperacionCVDivisas´´k Ç
,´´Ç É"
catalogo_divisas_R´´Ñ ñ
,´´ñ ó#
catalogo_posiciones´´ò ´
,´´´ ¨
conn´´≠ ±
!´´± ≤
)´´≤ ≥
;´´≥ ¥
}
¨¨ 
break
≠≠ !
;
≠≠! "
case
ÆÆ 
$num
ÆÆ 
:
ÆÆ  
if
ØØ 
(
ØØ  
respuestaAPI
ØØ  ,
.
ØØ, -)
ListaPosicionesPrimForwards
ØØ- H
!=
ØØI K
null
ØØL P
)
ØØP Q
{
∞∞ 
	respuesta
±±  )
=
±±* +
new
±±, /

DALRiesgos
±±0 :
(
±±: ;
)
±±; <
.
±±< =+
guardarPosicionesPrimForwards
±±= Z
(
±±Z [
respuestaAPI
±±[ g
.
±±g h*
ListaPosicionesPrimForwards±±h É
,±±É Ñ"
catalogo_divisas_R±±Ö ó
,±±ó ò
conn±±ô ù
!±±ù û
)±±û ü
;±±ü †
}
≤≤ 
break
≥≥ !
;
≥≥! "
default
¥¥ 
:
¥¥  
	respuesta
µµ %
.
µµ% &
mensaje
µµ& -
=
µµ. /
$str
µµ0 `
;
µµ` a
break
∂∂ !
;
∂∂! "
}
∑∑ 
}
∏∏ 
}
∫∫ 
catch
ªª 
(
ªª 
	Exception
ªª 
ex
ªª 
)
ªª  
{
ºº 
	respuesta
ΩΩ 
.
ΩΩ 
mensaje
ΩΩ !
=
ΩΩ" #
$"
ΩΩ$ &
$str
ΩΩ& -
{
ΩΩ- .
ex
ΩΩ. 0
.
ΩΩ0 1
Message
ΩΩ1 8
}
ΩΩ8 9
$str
ΩΩ9 =
{
ΩΩ= >
respuestaAPI
ΩΩ> J
.
ΩΩJ K
mensaje
ΩΩK R
}
ΩΩR S
$str
ΩΩS T
"
ΩΩT U
;
ΩΩU V
}
ææ 
return
¿¿ 
	respuesta
¿¿ 
;
¿¿ 
}
¡¡ 	
[
ƒƒ 	
HttpGet
ƒƒ	 
(
ƒƒ 
$str
ƒƒ >
)
ƒƒ> ?
]
ƒƒ? @
public
≈≈ 
async
≈≈ 
Task
≈≈ 
<
≈≈ 
	Respuesta
≈≈ #
>
≈≈# $
GetRiesgosRango
≈≈% 4
(
≈≈4 5
int
≈≈5 8
tipoReporte
≈≈9 D
,
≈≈D E
int
≈≈F I
fechaIni
≈≈J R
,
≈≈R S
int
≈≈T W
fechaFin
≈≈X `
,
≈≈` a
string
≈≈b h
token
≈≈i n
)
≈≈n o
{
∆∆ 	
	Respuesta
«« 
	respuesta
«« 
=
««  !
new
««" %
	Respuesta
««& /
(
««/ 0
)
««0 1
;
««1 2
ResultadoApi
»» 
respuestaAPI
»» %
=
»»& '
new
»»( +
ResultadoApi
»», 8
(
»»8 9
)
»»9 :
;
»»: ;
if
…… 
(
…… 
tipoReporte
…… 
==
…… 
$num
……  
)
……  !
{
   
try
ÀÀ 
{
ÃÃ 
respuestaAPI
ÕÕ  
=
ÕÕ! "
await
ÕÕ# (
_servicioApi
ÕÕ) 5
.
ÕÕ5 6
GetRiesgosRango
ÕÕ6 E
(
ÕÕE F
tipoReporte
ÕÕF Q
,
ÕÕQ R
fechaIni
ÕÕS [
,
ÕÕ[ \
fechaFin
ÕÕ] e
,
ÕÕe f
token
ÕÕg l
)
ÕÕl m
;
ÕÕm n
}
ŒŒ 
catch
œœ 
(
œœ 
	Exception
œœ  
ex
œœ! #
)
œœ# $
{
–– 
	respuesta
—— 
.
—— 
mensaje
—— %
=
——& '
$str
——( 1
+
——2 3
ex
——4 6
.
——6 7
Message
——7 >
+
——? @
$str
——A E
+
——F G
respuestaAPI
——H T
.
——T U
mensaje
——U \
;
——\ ]
}
““ 
if
‘‘ 
(
‘‘ 
respuestaAPI
‘‘  
.
‘‘  !(
ListaComprasVentasOperador
‘‘! ;
!=
‘‘< >
null
‘‘? C
)
‘‘C D
{
’’ 
	respuesta
÷÷ 
=
÷÷ 
new
÷÷  #

DALRiesgos
÷÷$ .
(
÷÷. /
)
÷÷/ 0
.
÷÷0 1*
guardarComprasVentasOperador
÷÷1 M
(
÷÷M N
respuestaAPI
÷÷N Z
.
÷÷Z [(
ListaComprasVentasOperador
÷÷[ u
,
÷÷u v
conn
÷÷w {
!
÷÷{ |
,
÷÷| }
fechaIni÷÷~ Ü
,÷÷Ü á
fechaFin÷÷à ê
)÷÷ê ë
;÷÷ë í
}
◊◊ 
else
ÿÿ 
{
ŸŸ 
	respuesta
⁄⁄ 
.
⁄⁄ 
mensaje
⁄⁄ %
=
⁄⁄& '
$str
⁄⁄( h
;
⁄⁄h i
}
€€ 
}
‹‹ 
else
›› 
{
ﬁﬁ 
	respuesta
ﬂﬂ 
.
ﬂﬂ 
mensaje
ﬂﬂ !
=
ﬂﬂ" #
$str
ﬂﬂ$ G
;
ﬂﬂG H
}
‡‡ 
return
‚‚ 
	respuesta
‚‚ 
;
‚‚ 
}
„„ 	
}
ÂÂ 
}ÊÊ ¸
£D:\Banobras\Sistemas .NET\SST3\SIVARMER\TransicionNvaFSW\Trunk\C√≥digo\API_DERIVADOS_ETAPA4_2024_06_06\apiRiesgos\apiRiesgos\Controllers\AutenticacionController.cs
	namespace 	

apiRiesgos
 
. 
Controllers  
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public		 

class		 #
AutenticacionController		 (
:		) *
ControllerBase		+ 9
{

 
private 
readonly 
IServicioApi %
_servicioApi& 2
;2 3
public #
AutenticacionController &
(& '
IServicioApi' 3
servicioApi4 ?
)? @
{ 	
_servicioApi 
= 
servicioApi &
;& '
} 	
[ 	
HttpGet	 
( 
$str .
). /
]/ 0
public 
async 
Task 
< 
ResultadoCredencial -
>- .
Autenticacion/ <
(< =
string= C
	client_idD M
,M N
stringO U
client_secretV c
)c d
{ 	
var 
	resultado 
= 
await !
_servicioApi" .
.. /
Autenticacion/ <
(< =
	client_id= F
,F G
client_secretH U
)U V
;V W
return 
	resultado 
; 
} 	
} 
} 