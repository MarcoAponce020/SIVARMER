ซ
D:\Banobras\Sistemas .NET\SST3\SIVARMER\TransicionNvaFSW\Trunk\Cรณdigo\WinSerAPIRiesgos_2024_06_04\WinSerAPIRiesgos\Helpers\OracleConnectionHelper.cs
	namespace 	
WinSerAPIRiesgos
 
. 
Helpers "
{ 
public

 

class

 "
OracleConnectionHelper

 '
{ 
public 
static 
OracleConnection &
GetConnection' 4
(4 5
)5 6
{ 	
string 
environmentVariable &
=' ( 
ConfigurationManager) =
.= >
AppSettings> I
.I J
GetJ M
(M N
$strN c
)c d
;d e
string $
environmentVariableValue +
=, -
Environment. 9
.9 :"
GetEnvironmentVariable: P
(P Q
environmentVariableQ d
)d e
;e f
if 
( 
! 
string 
. 
IsNullOrEmpty %
(% &$
environmentVariableValue& >
)> ?
)? @
{ 
var 
data 
= 
JsonConvert &
.& '
DeserializeObject' 8
<8 9 
EnvironmentVariables9 M
>M N
(N O$
environmentVariableValueO g
)g h
;h i
string 
connectionString '
=( ) 
ConfigurationManager* >
.> ?
ConnectionStrings? P
[P Q
$strQ a
]a b
.b c
ConnectionStringc s
;s t
string !
valueConnectionString ,
=- .
string/ 5
.5 6
Format6 <
(< =
connectionString= M
,M N
dataO S
.S T
DataBaseT \
.\ ]
ServerNameOrIP] k
,k l
datam q
.q r
DataBaser z
.z {
Port{ 
,	 
data
 
.
 
DataBase
 
.
 
Scheme
 
,
 
data
 
.
 
DataBase
 ค
.
ค ฅ
UserId
ฅ ซ
,
ซ ฌ
data
ญ ฑ
.
ฑ ฒ
DataBase
ฒ บ
.
บ ป
Password
ป ร
)
ร ฤ
;
ฤ ล
var 

connection 
=  
new! $
OracleConnection% 5
(5 6!
valueConnectionString6 K
)K L
;L M
return 

connection !
;! "
} 
return 
new 
OracleConnection '
(' (
)( )
;) *
} 	
} 
}!! ี
D:\Banobras\Sistemas .NET\SST3\SIVARMER\TransicionNvaFSW\Trunk\Cรณdigo\WinSerAPIRiesgos_2024_06_04\WinSerAPIRiesgos\Models\EnvironmentVariables.cs
	namespace 	
WinSerAPIRiesgos
 
. 
Models !
{ 
public 

class  
EnvironmentVariables %
{ 
public 
DataBaseVariables  
DataBase! )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
public 
EmailVariables 
Email #
{$ %
get& )
;) *
set+ .
;. /
}0 1
} 
public 

class 
DataBaseVariables "
{ 
public 
string 
ServerNameOrIP $
{% &
get' *
;* +
set, /
;/ 0
}1 2
=3 4
string5 ;
.; <
Empty< A
;A B
public 
int 
Port 
{ 
get 
; 
set "
;" #
}$ %
=& '
$num( )
;) *
public 
string 
Scheme 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
string- 3
.3 4
Empty4 9
;9 :
public 
string 
UserId 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
string- 3
.3 4
Empty4 9
;9 :
public!! 
string!! 
Password!! 
{!!  
get!!! $
;!!$ %
set!!& )
;!!) *
}!!+ ,
=!!- .
string!!/ 5
.!!5 6
Empty!!6 ;
;!!; <
}## 
public%% 

class%% 
EmailVariables%% 
{&& 
public(( 
string(( 
UserName(( 
{((  
get((! $
;(($ %
set((& )
;(() *
}((+ ,
=((- .
string((/ 5
.((5 6
Empty((6 ;
;((; <
public** 
string** 
Password** 
{**  
get**! $
;**$ %
set**& )
;**) *
}**+ ,
=**- .
string**/ 5
.**5 6
Empty**6 ;
;**; <
public,, 
string,, 
EncryptionKey,, #
{,,$ %
get,,& )
;,,) *
set,,+ .
;,,. /
},,0 1
=,,2 3
string,,4 :
.,,: ;
Empty,,; @
;,,@ A
}.. 
}00 ข
D:\Banobras\Sistemas .NET\SST3\SIVARMER\TransicionNvaFSW\Trunk\Cรณdigo\WinSerAPIRiesgos_2024_06_04\WinSerAPIRiesgos\Models\Mail.cs
	namespace 	
WinSerAPIRiesgos
 
. 
Models !
{ 
public 

class 
Mail 
{ 
public 
string 
EmailAddress "
{# $
get% (
;( )
set* -
;- .
}/ 0
public		 
bool		 
IsActive		 
{		 
get		 "
;		" #
set		$ '
;		' (
}		) *
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} 
D:\Banobras\Sistemas .NET\SST3\SIVARMER\TransicionNvaFSW\Trunk\Cรณdigo\WinSerAPIRiesgos_2024_06_04\WinSerAPIRiesgos\ProjectInstaller.cs
	namespace		 	
WinSerAPIRiesgos		
 
{

 
[ 
RunInstaller 
( 
true 
) 
] 
public 

partial 
class 
ProjectInstaller )
:* +
System, 2
.2 3
Configuration3 @
.@ A
InstallA H
.H I
	InstallerI R
{ 
public 
ProjectInstaller 
(  
)  !
{ 	
InitializeComponent 
(  
)  !
;! "
} 	
private 
void 1
%serviceProcessInstaller1_AfterInstall :
(: ;
object; A
senderB H
,H I
InstallEventArgsJ Z
e[ \
)\ ]
{ 	
} 	
} 
} !
D:\Banobras\Sistemas .NET\SST3\SIVARMER\TransicionNvaFSW\Trunk\Cรณdigo\WinSerAPIRiesgos_2024_06_04\WinSerAPIRiesgos\ProjectInstaller.Designer.cs
	namespace 	
WinSerAPIRiesgos
 
{ 
partial 
class 
ProjectInstaller "
{ 
private 
System 
. 
ComponentModel %
.% &

IContainer& 0

components1 ;
=< =
null> B
;B C
	protected 
override 
void 
Dispose  '
(' (
bool( ,
	disposing- 6
)6 7
{ 	
if 
( 
	disposing 
&& 
( 

components (
!=) +
null, 0
)0 1
)1 2
{ 

components 
. 
Dispose "
(" #
)# $
;$ %
} 
base 
. 
Dispose 
( 
	disposing "
)" #
;# $
} 	
private 
void 
InitializeComponent (
(( )
)) *
{ 	
this 
. $
serviceProcessInstaller1 )
=* +
new, /
System0 6
.6 7
ServiceProcess7 E
.E F#
ServiceProcessInstallerF ]
(] ^
)^ _
;_ `
this   
.   
serviceInstaller1   "
=  # $
new  % (
System  ) /
.  / 0
ServiceProcess  0 >
.  > ?
ServiceInstaller  ? O
(  O P
)  P Q
;  Q R
this$$ 
.$$ $
serviceProcessInstaller1$$ )
.$$) *
Account$$* 1
=$$2 3
System$$4 :
.$$: ;
ServiceProcess$$; I
.$$I J
ServiceAccount$$J X
.$$X Y
LocalSystem$$Y d
;$$d e
this%% 
.%% $
serviceProcessInstaller1%% )
.%%) *
Password%%* 2
=%%3 4
null%%5 9
;%%9 :
this&& 
.&& $
serviceProcessInstaller1&& )
.&&) *
Username&&* 2
=&&3 4
null&&5 9
;&&9 :
this'' 
.'' $
serviceProcessInstaller1'' )
.'') *
AfterInstall''* 6
+=''7 9
new'': =
System''> D
.''D E
Configuration''E R
.''R S
Install''S Z
.''Z [
InstallEventHandler''[ n
(''n o
this''o s
.''s t2
%serviceProcessInstaller1_AfterInstall	''t 
)
'' 
;
'' 
this++ 
.++ 
serviceInstaller1++ "
.++" #
Description++# .
=++/ 0
$str++1 \
;++\ ]
this,, 
.,, 
serviceInstaller1,, "
.,," #
ServiceName,,# .
=,,/ 0
$str,,1 E
;,,E F
this-- 
.-- 
serviceInstaller1-- "
.--" #
	StartType--# ,
=--- .
System--/ 5
.--5 6
ServiceProcess--6 D
.--D E
ServiceStartMode--E U
.--U V
	Automatic--V _
;--_ `
this11 
.11 

Installers11 
.11 
AddRange11 $
(11$ %
new11% (
System11) /
.11/ 0
Configuration110 =
.11= >
Install11> E
.11E F
	Installer11F O
[11O P
]11P Q
{11R S
this22 
.22 $
serviceProcessInstaller122 )
,22) *
this33 
.33 
serviceInstaller133 "
}33" #
)33# $
;33$ %
}55 	
private99 
System99 
.99 
ServiceProcess99 %
.99% &#
ServiceProcessInstaller99& =$
serviceProcessInstaller199> V
;99V W
private:: 
System:: 
.:: 
ServiceProcess:: %
.::% &
ServiceInstaller::& 6
serviceInstaller1::7 H
;::H I
};; 
}<< 
D:\Banobras\Sistemas .NET\SST3\SIVARMER\TransicionNvaFSW\Trunk\Cรณdigo\WinSerAPIRiesgos_2024_06_04\WinSerAPIRiesgos\Respuesta.cs
	namespace 	
WinSerAPIRiesgos
 
{ 
public		 

class		 
	Respuesta		 
{

 
public 
bool 
exito 
{ 
get 
;  
set! $
;$ %
}& '
public 
string 
mensaje 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} 
D:\Banobras\Sistemas .NET\SST3\SIVARMER\TransicionNvaFSW\Trunk\Cรณdigo\WinSerAPIRiesgos_2024_06_04\WinSerAPIRiesgos\ResultadoToken.cs
	namespace 	
WinSerAPIRiesgos
 
{ 
public		 

class		 
ResultadoToken		 
{

 
public 
string 
token 
{ 
get !
;! "
set# &
;& '
}( )
public 
bool 
exito 
{ 
get 
;  
set! $
;$ %
}& '
public 
string 
mensaje 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} ๏๎
D:\Banobras\Sistemas .NET\SST3\SIVARMER\TransicionNvaFSW\Trunk\Cรณdigo\WinSerAPIRiesgos_2024_06_04\WinSerAPIRiesgos\Service1.cs
	namespace 	
WinSerAPIRiesgos
 
{ 
public 

partial 
class 
Service1 !
:" #
ServiceBase$ /
{ 
private 
static 
readonly 
log4net  '
.' (
ILog( ,
log- 0
=1 2
log4net3 :
.: ;

LogManager; E
.E F
	GetLoggerF O
(O P
$strP `
)` a
;a b
Timer 
_timer 
= 
new 
Timer  
(  !
$num! &
)& '
;' (
static 
Service1 
( 
) 
{ 	
DOMConfigurator 
. 
	Configure %
(% &
)& '
;' (
} 	
public 
Service1 
( 
) 
{   	
InitializeComponent!! 
(!!  
)!!  !
;!!! "
}"" 	
	protected$$ 
override$$ 
void$$ 
OnStart$$  '
($$' (
string$$( .
[$$. /
]$$/ 0
args$$1 5
)$$5 6
{%% 	
_timer&& 
.&& 
Elapsed&& 
+=&& 
OnTimerElapsed&& ,
;&&, -
_timer'' 
.'' 
Start'' 
('' 
)'' 
;'' 
}(( 	
	protected** 
override** 
void** 
OnStop**  &
(**& '
)**' (
{++ 	
Console,, 
.,, 
	WriteLine,, 
(,, 
$str	,, พ
)
,,พ ฟ
;
,,ฟ ภ
_timer-- 
.-- 
Stop-- 
(-- 
)-- 
;-- 
_timer.. 
... 
Dispose.. 
(.. 
).. 
;.. 
Console00 
.00 
ReadLine00 
(00 
)00 
;00 
}11 	
public33 
void33 
Start33 
(33 
string33  
[33  !
]33! "
args33# '
)33' (
{44 	
OnStart55 
(55 
args55 
)55 
;55 
}66 	
private88 
void88 
OnTimerElapsed88 #
(88# $
object88$ *
sender88+ 1
,881 2
ElapsedEventArgs883 C
e88D E
)88E F
{99 	
log:: 
.:: 
Info:: 
(:: 
$str:: Z
)::Z [
;::[ \
log;; 
.;; 
Info;; 
(;; 
$str;; @
+;;A B
DateTime;;C K
.;;K L
Now;;L O
.;;O P
ToString;;P X
(;;X Y
);;Y Z
);;Z [
;;;[ \
string== 
hour== 
=== 
$str== '
;==' (
if?? 
(?? 
DateTime?? 
.?? 
Now?? 
.?? 
ToShortTimeString?? .
(??. /
)??/ 0
==??1 3
hour??4 8
)??8 9
{@@ 
stringAA 
rTokenAA 
=AA 
thisAA  $
.AA$ %
GetTokenAA% -
(AA- .
)AA. /
.AA/ 0
ResultAA0 6
;AA6 7
stringBB 

correoBodyBB !
=BB" #
$strBB$ &
;BB& '
intCC 
diasDeCargaCC 
=CC  !
$numCC" #
;CC# $
ifEE 
(EE 
DateTimeEE 
.EE 
NowEE  
.EE  !
	DayOfWeekEE! *
!=EE+ -
	DayOfWeekEE. 7
.EE7 8
MondayEE8 >
&&EE? A
DateTimeEEB J
.EEJ K
NowEEK N
.EEN O
	DayOfWeekEEO X
!=EEY [
	DayOfWeekEE\ e
.EEe f
SaturdayEEf n
&&EEo q
DateTimeEEr z
.EEz {
NowEE{ ~
.EE~ 
	DayOfWeek	EE 
!=
EE 
	DayOfWeek
EE 
.
EE 
Sunday
EE 
)
EE 
{FF 
diasDeCargaGG 
=GG  !
-GG" #
$numGG# $
;GG$ %
}HH 
elseII 
ifII 
(II 
DateTimeII !
.II! "
NowII" %
.II% &
	DayOfWeekII& /
==II0 2
	DayOfWeekII3 <
.II< =
MondayII= C
)IIC D
{JJ 
diasDeCargaKK 
=KK  !
-KK" #
$numKK# $
;KK$ %
}LL 
varNN 
fechaReporteNN  
=NN! "
DateTimeNN# +
.NN+ ,
NowNN, /
.NN/ 0
AddDaysNN0 7
(NN7 8
diasDeCargaNN8 C
)NNC D
.NND E
ToStringNNE M
(NNM N
$strNNN X
)NNX Y
;NNY Z

correoBodyPP 
+=PP 
ejecutarReportePP -
(PP- .
$numPP. /
,PP/ 0
$strPP1 H
,PPH I
fechaReportePPJ V
,PPV W
rTokenPPX ^
)PP^ _
.PP_ `
ResultPP` f
+PPg h
$strPPi o
;PPo p

correoBodyQQ 
+=QQ 
ejecutarReporteQQ -
(QQ- .
$numQQ. /
,QQ/ 0
$strQQ1 F
,QQF G
fechaReporteQQH T
,QQT U
rTokenQQV \
)QQ\ ]
.QQ] ^
ResultQQ^ d
+QQe f
$strQQg m
;QQm n

correoBodyRR 
+=RR 
ejecutarReporteRR -
(RR- .
$numRR. /
,RR/ 0
$strRR1 I
,RRI J
fechaReporteRRK W
,RRW X
rTokenRRY _
)RR_ `
.RR` a
ResultRRa g
+RRh i
$strRRj p
;RRp q

correoBodySS 
+=SS 
ejecutarReporteSS -
(SS- .
$numSS. /
,SS/ 0
$strSS1 D
,SSD E
fechaReporteSSF R
,SSR S
rTokenSST Z
)SSZ [
.SS[ \
ResultSS\ b
+SSc d
$strSSe k
;SSk l

correoBodyTT 
+=TT 
ejecutarReporteTT -
(TT- .
$numTT. /
,TT/ 0
$strTT1 G
,TTG H
fechaReporteTTI U
,TTU V
rTokenTTW ]
)TT] ^
.TT^ _
ResultTT_ e
+TTf g
$strTTh n
;TTn o

correoBodyUU 
+=UU 
ejecutarReporteUU -
(UU- .
$numUU. /
,UU/ 0
$strUU1 A
,UUA B
fechaReporteUUC O
,UUO P
rTokenUUQ W
)UUW X
.UUX Y
ResultUUY _
+UU` a
$strUUb h
;UUh i

correoBodyVV 
+=VV 
ejecutarReporteVV -
(VV- .
$numVV. /
,VV/ 0
$strVV1 L
,VVL M
fechaReporteVVN Z
,VVZ [
rTokenVV\ b
)VVb c
.VVc d
ResultVVd j
+VVk l
$strVVm s
;VVs t

correoBodyWW 
+=WW 
ejecutarReporteWW -
(WW- .
$numWW. /
,WW/ 0
$strWW1 M
,WWM N
fechaReporteWWO [
,WW[ \
rTokenWW] c
)WWc d
.WWd e
ResultWWe k
+WWl m
$strWWn t
;WWt u

correoBodyXX 
+=XX 
ejecutarReporteXX -
(XX- .
$numXX. 0
,XX0 1
$strXX2 I
,XXI J
fechaReporteXXK W
,XXW X
rTokenXXY _
)XX_ `
.XX` a
ResultXXa g
+XXh i
$strXXj p
;XXp q

correoBodyYY 
+=YY 
ejecutarReporteYY -
(YY- .
$numYY. 0
,YY0 1
$strYY2 K
,YYK L
fechaReporteYYM Y
,YYY Z
rTokenYY[ a
)YYa b
.YYb c
ResultYYc i
+YYj k
$strYYl r
;YYr s

correoBodyZZ 
+=ZZ 
ejecutarReporteZZ -
(ZZ- .
$numZZ. 0
,ZZ0 1
$strZZ2 L
,ZZL M
fechaReporteZZN Z
,ZZZ [
rTokenZZ\ b
)ZZb c
.ZZc d
ResultZZd j
+ZZk l
$strZZm s
;ZZs t
EnviarEvidencia\\ 
(\\  

correoBody\\  *
,\\* +
DateTime\\, 4
.\\4 5
Now\\5 8
.\\8 9
ToString\\9 A
(\\A B
)\\B C
)\\C D
;\\D E
log]] 
.]] 
Info]] 
(]] 
$str]] D
+]]E F
DateTime]]G O
.]]O P
Now]]P S
.]]S T
ToString]]T \
(]]\ ]
)]]] ^
)]]^ _
;]]_ `
}^^ 
}__ 	
publicee 
asyncee 
Taskee 
<ee 
stringee  
>ee  !
GetTokenee" *
(ee* +
)ee+ ,
{ff 	
stringgg 
tokengg 
=gg 
$strgg 
;gg 
stringhh 
URLhh 
=hh  
ConfigurationManagerhh -
.hh- .
AppSettingshh. 9
[hh9 :
$strhh: D
]hhD E
;hhE F
stringii 
urlParametersii  
=ii! " 
ConfigurationManagerii# 7
.ii7 8
AppSettingsii8 C
[iiC D
$striiD S
]iiS T
;iiT U
tryll 
{mm 
usingnn 
(nn 
varnn 
clientnn !
=nn" #
newnn$ '

HttpClientnn( 2
(nn2 3
)nn3 4
)nn4 5
{oo 
clientpp 
.pp 
BaseAddresspp &
=pp' (
newpp) ,
Uripp- 0
(pp0 1
URLpp1 4
)pp4 5
;pp5 6
clientqq 
.qq !
DefaultRequestHeadersqq 0
.qq0 1
Acceptqq1 7
.qq7 8
Clearqq8 =
(qq= >
)qq> ?
;qq? @
clientrr 
.rr !
DefaultRequestHeadersrr 0
.rr0 1
Acceptrr1 7
.rr7 8
Addrr8 ;
(rr; <
newrr< ?+
MediaTypeWithQualityHeaderValuerr@ _
(rr_ `
$strrr` r
)rrr s
)rrs t
;rrt u
HttpResponseMessagett '
responsett( 0
=tt1 2
awaittt3 8
clienttt9 ?
.tt? @
GetAsynctt@ H
(ttH I
urlParametersttI V
)ttV W
;ttW X
ifuu 
(uu 
responseuu  
.uu  !
IsSuccessStatusCodeuu! 4
)uu4 5
{vv 
ResultadoTokenww &

departmentww' 1
=ww2 3
awaitww4 9
responseww: B
.wwB C
ContentwwC J
.wwJ K
ReadAsAsyncwwK V
<wwV W
ResultadoTokenwwW e
>wwe f
(wwf g
)wwg h
;wwh i
tokenxx 
=xx 

departmentxx  *
.xx* +
tokenxx+ 0
;xx0 1
logyy 
.yy 
Infoyy  
(yy  !
$stryy! A
)yyA B
;yyB C
}zz 
else{{ 
{|| 
log}} 
.}} 
Error}} !
(}}! "
$str}}" 9
)}}9 :
;}}: ;
}~~ 
} 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
token
 
=
 
$"
 
$str
 2
{
2 3
ex
3 5
.
5 6
Message
6 =
}
= >
"
> ?
;
? @
log
 
.
 
Error
 
(
 
token
 
)
  
;
  !
}
 
return
 
token
 
;
 
}
 	
public
 
async
 
Task
 
<
 
string
  
>
  !
ejecutarReporte
" 1
(
1 2
int
2 5
tipo
6 :
,
: ;
string
; A
nombre
B H
,
H I
string
J P
fecha
Q V
,
V W
string
X ^
token
_ d
)
d e
{
 	
string
 
Url
 
=
 "
ConfigurationManager
 -
.
- .
AppSettings
. 9
[
9 :
$str
: F
]
F G
;
G H
string
 

correoBody
 
=
 
$str
  "
;
" #
try
 
{
 
using
 
(
 
var
 
client
 !
=
" #
new
$ '

HttpClient
( 2
(
2 3
)
3 4
)
4 5
{
 
client
 
.
 
BaseAddress
 &
=
' (
new
) ,
Uri
- 0
(
0 1
Url
1 4
)
4 5
;
5 6
client
 
.
 #
DefaultRequestHeaders
 0
.
0 1
Accept
1 7
.
7 8
Clear
8 =
(
= >
)
> ?
;
? @
client
 
.
 #
DefaultRequestHeaders
 0
.
0 1
Accept
1 7
.
7 8
Add
8 ;
(
; <
new
< ?-
MediaTypeWithQualityHeaderValue
@ _
(
_ `
$str
` r
)
r s
)
s t
;
t u!
HttpResponseMessage
 '
response
( 0
=
1 2
await
3 8
client
9 ?
.
? @
GetAsync
@ H
(
H I
$"
I K
{
K L
tipo
M Q
}
R S
$str
S T
{
T U
fecha
V [
}
\ ]
$str
] ^
{
^ _
token
` e
}
f g
"
g h
)
h i
;
i j
if
 
(
 
response
  
.
  !!
IsSuccessStatusCode
! 4
)
4 5
{
 
	Respuesta
 !

department
" ,
=
- .
await
/ 4
response
5 =
.
= >
Content
> E
.
E F
ReadAsAsync
F Q
<
Q R
	Respuesta
R [
>
[ \
(
\ ]
)
] ^
;
^ _
log
 
.
 
Info
  
(
  !
$"
! #
$str
# 3
{
3 4
tipo
5 9
}
9 :
$str
: <
{
< =

department
> H
.
H I
mensaje
I P
}
P Q
"
Q R
)
R S
;
S T

correoBody
 "
=
# $
$"
% '
$str
' 7
{
7 8
nombre
9 ?
}
@ A
$str
A C
{
C D

department
E O
.
O P
mensaje
P W
}
W X
"
X Y
;
Y Z
}
 
else
 
{
 
log
 
.
 
Error
 !
(
! "
$str
" 9
)
9 :
;
: ;
}
กก 
}
ขข 
}
ฃฃ 
catch
คค 
(
คค 
	Exception
คค 
ex
คค 
)
คค  
{
ฅฅ 

correoBody
ฆฆ 
=
ฆฆ 
$str
ฆฆ I
+
ฆฆJ K
tipo
ฆฆL P
+
ฆฆQ R
$str
ฆฆS W
;
ฆฆW X
log
งง 
.
งง 
Error
งง 
(
งง 
$str
งง F
+
งงG H
tipo
งงI M
+
งงN O
$str
งงP T
+
งงU V
ex
งงW Y
.
งงY Z
Message
งงZ a
)
งงa b
;
งงb c
}
จจ 
return
ฉฉ 

correoBody
ฉฉ 
;
ฉฉ 
}
ซซ 	
public
ญญ 
async
ญญ 
Task
ญญ 
EnviarEvidencia
ญญ )
(
ญญ) *
string
ญญ* 0
comentarios
ญญ1 <
,
ญญ< =
string
ญญ> D
fecOper
ญญE L
)
ญญL M
{
ฎฎ 	
	Respuesta
ฏฏ 
response
ฏฏ 
=
ฏฏ  
new
ฏฏ! $
	Respuesta
ฏฏ% .
{
ฏฏ/ 0
exito
ฏฏ1 6
=
ฏฏ7 8
false
ฏฏ9 >
}
ฏฏ? @
;
ฏฏ@ A
string
ฑฑ 
user
ฑฑ 
=
ฑฑ 
string
ฑฑ  
.
ฑฑ  !
Empty
ฑฑ! &
;
ฑฑ& '
string
ฒฒ 
password
ฒฒ 
=
ฒฒ 
string
ฒฒ $
.
ฒฒ$ %
Empty
ฒฒ% *
;
ฒฒ* +
string
ณณ !
environmentVariable
ณณ &
=
ณณ' ("
ConfigurationManager
ณณ) =
.
ณณ= >
AppSettings
ณณ> I
.
ณณI J
Get
ณณJ M
(
ณณM N
$str
ณณN c
)
ณณc d
;
ณณd e
string
ดด &
environmentVariableValue
ดด +
=
ดด, -
Environment
ดด. 9
.
ดด9 :$
GetEnvironmentVariable
ดด: P
(
ดดP Q!
environmentVariable
ดดQ d
)
ดดd e
;
ดดe f
if
ตต 
(
ตต 
!
ตต 
string
ตต 
.
ตต 
IsNullOrEmpty
ตต %
(
ตต% &&
environmentVariableValue
ตต& >
)
ตต> ?
)
ตต? @
{
ถถ 
var
ทท 
data
ทท 
=
ทท 
JsonConvert
ทท &
.
ทท& '
DeserializeObject
ทท' 8
<
ทท8 9"
EnvironmentVariables
ทท9 M
>
ททM N
(
ททN O&
environmentVariableValue
ททO g
)
ททg h
;
ททh i
user
ธธ 
=
ธธ 
data
ธธ 
.
ธธ 
Email
ธธ !
.
ธธ! "
UserName
ธธ" *
;
ธธ* +
password
นน 
=
นน 
data
นน 
.
นน  
Email
นน  %
.
นน% &
Password
นน& .
;
นน. /
}
บบ 
else
ปป 
{
ผผ 
response
ฝฝ 
.
ฝฝ 
mensaje
ฝฝ  
=
ฝฝ! "
$str
ฝฝ# F
;
ฝฝF G
log
พพ 
.
พพ 
Error
พพ 
(
พพ 
$str
พพ =
)
พพ= >
;
พพ> ?
return
ฟฟ 
;
ฟฟ 
}
ภภ 
try
ยย 
{
รร 
string
ฤฤ 

correoFrom
ฤฤ !
=
ฤฤ" #"
ConfigurationManager
ฤฤ$ 8
.
ฤฤ8 9
AppSettings
ฤฤ9 D
[
ฤฤD E
$str
ฤฤE S
]
ฤฤS T
;
ฤฤT U
string
ลล 
correoAsunto
ลล #
=
ลล$ %"
ConfigurationManager
ลล& :
.
ลล: ;
AppSettings
ลล; F
[
ลลF G
$str
ลลG U
]
ลลU V
;
ลลV W
MailMessage
วว 
message
วว #
=
วว$ %
new
วว& )
MailMessage
วว* 5
(
วว5 6
)
วว6 7
;
วว7 8

SmtpClient
ศศ 

smtpServer
ศศ %
=
ศศ& '
new
ศศ( +

SmtpClient
ศศ, 6
(
ศศ6 7"
ConfigurationManager
ศศ7 K
.
ศศK L
AppSettings
ศศL W
[
ศศW X
$str
ศศX j
]
ศศj k
,
ศศk l
$num
ศศm o
)
ศศo p
;
ศศp q

smtpServer
ษษ 
.
ษษ 
	EnableSsl
ษษ $
=
ษษ% &
true
ษษ' +
;
ษษ+ ,
message
สส 
.
สส 
From
สส 
=
สส 
new
สส "
MailAddress
สส# .
(
สส. /

correoFrom
สส/ 9
,
สส9 :
correoAsunto
สส; G
,
สสG H
System
สสI O
.
สสO P
Text
สสP T
.
สสT U
Encoding
สสU ]
.
สส] ^
UTF8
สส^ b
)
สสb c
;
สสc d
message
หห 
.
หห 
Subject
หห 
=
หห  !
correoAsunto
หห" .
;
หห. /
var
ออ 
mailList
ออ 
=
ออ 
await
ออ $
this
ออ% )
.
ออ) *"
GetMailsFromDataBase
ออ* >
(
ออ> ?
)
ออ? @
;
ออ@ A
if
ฮฮ 
(
ฮฮ 
mailList
ฮฮ 
.
ฮฮ 
Any
ฮฮ  
(
ฮฮ  !
)
ฮฮ! "
&&
ฮฮ# %
mailList
ฮฮ& .
.
ฮฮ. /
Count
ฮฮ/ 4
>
ฮฮ5 6
$num
ฮฮ7 8
)
ฮฮ8 9
{
ฯฯ 
mailList
ะะ 
.
ะะ 
ForEach
ะะ $
(
ะะ$ %
item
ะะ% )
=>
ะะ* ,
{
ะะ- .
message
ัั 
.
ัั  
To
ัั  "
.
ัั" #
Add
ัั# &
(
ัั& '
item
ัั' +
.
ัั+ ,
EmailAddress
ัั, 8
)
ัั8 9
;
ัั9 :
log
าา 
.
าา 
Info
าา  
(
าา  !
$"
าา! #
$str
าา# 3
{
าา3 4
item
าา4 8
.
าา8 9
EmailAddress
าา9 E
}
าาE F
"
าาF G
)
าาG H
;
าาH I
}
ำำ 
)
ำำ 
;
ำำ 
message
ีี 
.
ีี 

IsBodyHtml
ีี &
=
ีี' (
true
ีี) -
;
ีี- .
message
ึึ 
.
ึึ 
Body
ึึ  
=
ึึ! "
this
ึึ# '
.
ึึ' (
GetMailTemplate
ึึ( 7
(
ึึ7 8
comentarios
ึึ8 C
)
ึึC D
;
ึึD E

SmtpClient
ุุ 
client
ุุ %
=
ุุ& '
new
ุุ( +

SmtpClient
ุุ, 6
(
ุุ6 7"
ConfigurationManager
ุุ7 K
.
ุุK L
AppSettings
ุุL W
[
ุุW X
$str
ุุX j
]
ุุj k
,
ุุk l
$num
ุุm o
)
ุุo p
;
ุุp q
client
ูู 
.
ูู #
UseDefaultCredentials
ูู 0
=
ูู1 2
false
ูู3 8
;
ูู8 9
client
ฺฺ 
.
ฺฺ 
Credentials
ฺฺ &
=
ฺฺ' (
new
ฺฺ) ,
System
ฺฺ- 3
.
ฺฺ3 4
Net
ฺฺ4 7
.
ฺฺ7 8
NetworkCredential
ฺฺ8 I
(
ฺฺI J
user
ฺฺJ N
,
ฺฺN O
password
ฺฺP X
,
ฺฺX Y
$str
ฺฺZ d
)
ฺฺd e
;
ฺฺe f
client
 
.
 
	EnableSsl
 $
=
% &
true
' +
;
+ ,
client
 
.
 
Send
 
(
  
message
  '
)
' (
;
( )
response
 
.
 
exito
 "
=
# $
true
% )
;
) *
response
฿฿ 
.
฿฿ 
mensaje
฿฿ $
=
฿฿% &
$str
฿฿' L
;
฿฿L M
log
เเ 
.
เเ 
Info
เเ 
(
เเ 
$str
เเ B
)
เเB C
;
เเC D
}
แแ 
else
โโ 
{
ใใ 
response
ไไ 
.
ไไ 
exito
ไไ "
=
ไไ# $
true
ไไ% )
;
ไไ) *
response
ๅๅ 
.
ๅๅ 
mensaje
ๅๅ $
=
ๅๅ% &
$str
ๅๅ' ]
;
ๅๅ] ^
log
ๆๆ 
.
ๆๆ 
Warn
ๆๆ 
(
ๆๆ 
$str
ๆๆ S
)
ๆๆS T
;
ๆๆT U
}
็็ 
}
่่ 
catch
้้ 
(
้้ 
	Exception
้้ 
ex
้้ 
)
้้  
{
๊๊ 
response
๋๋ 
.
๋๋ 
mensaje
๋๋  
=
๋๋! "
$"
๋๋# %
$str
๋๋% H
{
๋๋H I
ex
๋๋I K
.
๋๋K L
Message
๋๋L S
}
๋๋S T
"
๋๋T U
;
๋๋U V
log
์์ 
.
์์ 
Error
์์ 
(
์์ 
ex
์์ 
)
์์ 
;
์์ 
log
ํํ 
.
ํํ 
Error
ํํ 
(
ํํ 
response
ํํ "
.
ํํ" #
mensaje
ํํ# *
)
ํํ* +
;
ํํ+ ,
}
๎๎ 
}
๏๏ 	
private
๖๖ 
string
๖๖ 
GetMailTemplate
๖๖ &
(
๖๖& '
string
๖๖' -
comentarios
๖๖. 9
)
๖๖9 :
{
๗๗ 	
string
๘๘ 
tempalte
๘๘ 
=
๘๘ 
$str
๘๘ M
+
๘๘N O
$str
๙๙ #
+
๙๙$ %
$str
๚๚ j
+
๚๚k l
$str
๛๛ $
+
๛๛% &
$str
 #
+
$ %
$str
 h
+
i j
$str
 )
+
* +
$str 
+ 
$str
 1
+
2 3
$str
 1
+
2 3
$str
 s
+
t u
$str
 5
+
6 7
$str
 m
+
n o
$str
 6
+
7 8
$str
 5
+
6 7
$str ว
+ศ ษ
$str
 z
+
{ |
$str
 L
+
M N
$str
 ?
+
@ A
$str
 z
+
{ |
$str
 v
+
w x
$str
 ?
+
@ A
$str
 :
+
; <
$str
 6
+
7 8
$str
 5
+
6 7
$str 
+ 
$str 
+ 
$str
 A
+
B C
$str ึ
+ื ุ
$str
 l
+
m n
$str
 F
+
G H
$str
 B
+
C D
$str
 A
+
B C
$str 
+ 
$str
 A
+
B C
$str 
+ 
$str
 F
+
G H
$str ท
+ธ น
$str
 e
+
f g
$str
 U
+
V W
$str
 K
+
L M
$str
กก K
+
กกL M
$str
ขข e
+
ขขf g
comentarios
ขขh s
+
ขขt u
$str
ฃฃ M
+
ฃฃN O
$str
คค K
+
คคL M
$str
ฅฅ F
+
ฅฅG H
$str
ฆฆ B
+
ฆฆC D
$str
งง A
+
งงB C
$strจจ 
+จจ ก
$str
ฉฉ A
+
ฉฉB C
$strชช ร
+ชชฤ ล
$strซซ 
+ซซ 
$str
ฌฌ o
+
ฌฌp q
$str
ญญ K
+
ญญL M
$str
ฎฎ F
+
ฎฎG H
$str
ฏฏ B
+
ฏฏC D
$str
ฐฐ A
+
ฐฐB C
$str
ฑฑ :
+
ฑฑ; <
$str
ฒฒ 6
+
ฒฒ7 8
$str
ณณ 5
+
ณณ6 7
$str
ดด 1
+
ดด2 3
$str
ตต 1
+
ตต2 3
$str
ถถ .
+
ถถ/ 0
$str
ทท *
+
ทท+ ,
$str
ธธ )
+
ธธ* +
$str
นน $
+
นน% &
$str
บบ $
;
บบ$ %
return
ผผ 
tempalte
ผผ 
;
ผผ 
}
ฝฝ 	
private
รร 
async
รร 
Task
รร 
<
รร 
List
รร 
<
รร  
Mail
รร  $
>
รร$ %
>
รร% &"
GetMailsFromDataBase
รร' ;
(
รร; <
)
รร< =
{
ฤฤ 	
List
ลล 
<
ลล 
Mail
ลล 
>
ลล 
mailList
ลล 
=
ลล  !
new
ลล" %
List
ลล& *
<
ลล* +
Mail
ลล+ /
>
ลล/ 0
(
ลล0 1
)
ลล1 2
;
ลล2 3
var
ฦฦ 

connection
ฦฦ 
=
ฦฦ $
OracleConnectionHelper
ฦฦ 3
.
ฦฦ3 4
GetConnection
ฦฦ4 A
(
ฦฦA B
)
ฦฦB C
;
ฦฦC D
string
วว 
strSQL
วว 
=
วว 
$str
วว ]
;
วว] ^
using
ษษ 
(
ษษ 
OracleCommand
ษษ  
cmd
ษษ! $
=
ษษ% &
new
ษษ' *
OracleCommand
ษษ+ 8
(
ษษ8 9
strSQL
ษษ9 ?
,
ษษ? @

connection
ษษA K
)
ษษK L
)
ษษL M
{
สส 
await
หห 

connection
หห  
.
หห  !
	OpenAsync
หห! *
(
หห* +
)
หห+ ,
;
หห, -
cmd
ฬฬ 
.
ฬฬ 
CommandType
ฬฬ 
=
ฬฬ  !
CommandType
ฬฬ" -
.
ฬฬ- .
Text
ฬฬ. 2
;
ฬฬ2 3
cmd
ออ 
.
ออ 
CommandText
ออ 
=
ออ  !
strSQL
ออ" (
;
ออ( )
cmd
ฮฮ 
.
ฮฮ 

BindByName
ฮฮ 
=
ฮฮ  
true
ฮฮ! %
;
ฮฮ% &
var
ะะ 
reader
ะะ 
=
ะะ 
await
ะะ "
cmd
ะะ# &
.
ะะ& ' 
ExecuteReaderAsync
ะะ' 9
(
ะะ9 :
)
ะะ: ;
;
ะะ; <
if
ัั 
(
ัั 
reader
ัั 
.
ัั 
HasRows
ัั "
)
ัั" #
{
าา 
var
ำำ 
result
ำำ 
=
ำำ  
reader
ำำ! '
.
ำำ' (
Cast
ำำ( ,
<
ำำ, -
IDataRecord
ำำ- 8
>
ำำ8 9
(
ำำ9 :
)
ำำ: ;
.
ิิ( )
Select
ิิ) /
(
ิิ/ 0
dr
ิิ0 2
=>
ิิ3 5
new
ิิ6 9
Mail
ิิ: >
{
ีี( )
EmailAddress
ึึ, 8
=
ึึ9 :
dr
ึึ; =
[
ึึ= >
$str
ึึ> L
]
ึึL M
.
ึึM N
ToString
ึึN V
(
ึึV W
)
ึึW X
,
ึึX Y
UserName
ืื, 4
=
ืื5 6
dr
ืื7 9
[
ืื9 :
$str
ืื: D
]
ืืD E
.
ืืE F
ToString
ืืF N
(
ืืN O
)
ืืO P
,
ืืP Q
IsActive
ุุ, 4
=
ุุ5 6
true
ุุ7 ;
}
ูู( )
)
ูู) *
;
ูู* +
mailList
 
=
 
result
 %
.
% &
ToList
& ,
(
, -
)
- .
;
. /
}
 
reader
 
.
 
Close
 
(
 
)
 
;
 
reader
 
.
 
Dispose
 
(
 
)
  
;
  !
}
฿฿ 
return
แแ 
mailList
แแ 
;
แแ 
}
โโ 	
}
ไไ 
}ๅๅ 
D:\Banobras\Sistemas .NET\SST3\SIVARMER\TransicionNvaFSW\Trunk\Cรณdigo\WinSerAPIRiesgos_2024_06_04\WinSerAPIRiesgos\Service1.Designer.cs
	namespace 	
WinSerAPIRiesgos
 
{ 
partial 
class 
Service1 
{ 
private 
System 
. 
ComponentModel %
.% &

IContainer& 0

components1 ;
=< =
null> B
;B C
	protected 
override 
void 
Dispose  '
(' (
bool( ,
	disposing- 6
)6 7
{ 	
if 
( 
	disposing 
&& 
( 

components (
!=) +
null, 0
)0 1
)1 2
{ 

components 
. 
Dispose "
(" #
)# $
;$ %
} 
base 
. 
Dispose 
( 
	disposing "
)" #
;# $
} 	
private 
void 
InitializeComponent (
(( )
)) *
{ 	

components 
= 
new 
System #
.# $
ComponentModel$ 2
.2 3
	Container3 <
(< =
)= >
;> ?
this   
.   
ServiceName   
=   
$str   )
;  ) *
}!! 	
}$$ 
}%% 
~D:\Banobras\Sistemas .NET\SST3\SIVARMER\TransicionNvaFSW\Trunk\Cรณdigo\WinSerAPIRiesgos_2024_06_04\WinSerAPIRiesgos\Program.cs
	namespace 	
WinSerAPIRiesgos
 
{ 
internal 
static 
class 
Program !
{ 
static 
void 
Main 
( 
) 
{ 	
ServiceBase 
[ 
] 
ServicesToRun '
;' (
ServicesToRun 
= 
new 
ServiceBase  +
[+ ,
], -
{ 
new 
Service1 
( 
) 
} 
; 
if 
( 
Environment 
. 
UserInteractive +
)+ ,
{ 
Console 
. 
	WriteLine !
(! "
$str" D
)D E
;E F
( 
( 
Service1 
) 
ServicesToRun (
[( )
$num) *
]* +
)+ ,
., -
Start- 2
(2 3
null3 7
)7 8
;8 9
Console 
. 
ReadLine  
(  !
)! "
;" #
( 
( 
Service1 
) 
ServicesToRun (
[( )
$num) *
]* +
)+ ,
., -
Stop- 1
(1 2
)2 3
;3 4
} 
else 
{ 
ServiceBase 
. 
Run 
(  
ServicesToRun  -
)- .
;. /
} 
}   	
}!! 
}"" บ
D:\Banobras\Sistemas .NET\SST3\SIVARMER\TransicionNvaFSW\Trunk\Cรณdigo\WinSerAPIRiesgos_2024_06_04\WinSerAPIRiesgos\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str +
)+ ,
], -
[		 
assembly		 	
:			 

AssemblyDescription		 
(		 
$str		 !
)		! "
]		" #
[

 
assembly

 	
:

	 
!
AssemblyConfiguration

  
(

  !
$str

! #
)

# $
]

$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str 
) 
] 
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str -
)- .
]. /
[ 
assembly 	
:	 

AssemblyCopyright 
( 
$str 0
)0 1
]1 2
[ 
assembly 	
:	 

AssemblyTrademark 
( 
$str 
)  
]  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8
[## 
assembly## 	
:##	 

AssemblyVersion## 
(## 
$str## $
)##$ %
]##% &
[$$ 
assembly$$ 	
:$$	 

AssemblyFileVersion$$ 
($$ 
$str$$ (
)$$( )
]$$) *ณ
ฐD:\Banobras\Sistemas .NET\SST3\SIVARMER\TransicionNvaFSW\Trunk\Cรณdigo\WinSerAPIRiesgos_2024_06_04\WinSerAPIRiesgos\obj\Debug\.NETFramework,Version=v4.7.2.AssemblyAttributes.cs
[ 
assembly 	
:	 

global 
:: 
System 
. 
Runtime !
.! "

Versioning" ,
., -$
TargetFrameworkAttribute- E
(E F
$strF d
,d e 
FrameworkDisplayNamef z
={ |
$str	} 
)
 
]
 